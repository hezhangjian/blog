<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hezhangjian.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12,"onmobile":false},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null,"show_result":false},"fold":{"enable":false,"height":500},"language":false,"highlight_theme":"normal"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="å¼ ä¿­çš„åšå®¢">
<meta property="og:url" content="https://hezhangjian.com/page/7/index.html">
<meta property="og:site_name" content="å¼ ä¿­çš„åšå®¢">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Zhangjian He">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://hezhangjian.com/page/7/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/7/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>å¼ ä¿­çš„åšå®¢</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">å¼ ä¿­çš„åšå®¢</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zhangjian He</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">135</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/hezhangjian" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;hezhangjian" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://x.com/hezhangjian" title="Twitter â†’ https:&#x2F;&#x2F;x.com&#x2F;hezhangjian" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hezhangjian.com/2021/12/12/Go%20%E8%B0%83%E7%94%A8%E4%BA%A4%E4%BA%92%E5%BC%8Fshell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangjian He">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/12/Go%20%E8%B0%83%E7%94%A8%E4%BA%A4%E4%BA%92%E5%BC%8Fshell/" class="post-title-link" itemprop="url">Go è°ƒç”¨äº¤äº’å¼shell</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-12-12 17:34:56" itemprop="dateCreated datePublished" datetime="2021-12-12T17:34:56+08:00">2021-12-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-21 20:55:02" itemprop="dateModified" datetime="2025-10-21T20:55:02+08:00">2025-10-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>æœ¬æ–‡çš„ä»£ç å·²ä¸Šä¼ åˆ°<a target="_blank" rel="noopener" href="https://github.com/hezhangjian/go_demo/blob/main/demo_shell/interactive_shell_test.go">github</a></p>
<p>äº¤äº’å¼shellå¸¸ç”¨åœ¨è¾“å…¥å¯†ç çš„åœºæ™¯ï¼Œä¸ºäº†é˜²æ­¢å¯†ç æ³„éœ²åœ¨<code>cmdline</code>ä¸­è¢«<code>ps -ef</code>è¯»å–</p>
<p>ä¸¾ä¸ªğŸŒ°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -s -p <span class="string">&quot;Enter Password: &quot;</span>  <span class="built_in">pwd</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\nYour password is: &quot;</span> <span class="variable">$pwd</span></span><br></pre></td></tr></table></figure>

<p>goè°ƒç”¨äº¤äº’å¼shellä»£ç æ ·ä¾‹å¦‚ä¸‹</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCallInteractiveShell</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	dir, err := os.Getwd()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	cmd := exec.Command(<span class="string">&quot;/bin/bash&quot;</span>, dir+<span class="string">&quot;/interactive_shell.sh&quot;</span>)</span><br><span class="line">	<span class="keyword">var</span> stdout, stderr bytes.Buffer</span><br><span class="line">	cmd.Stdout = &amp;stdout</span><br><span class="line">	cmd.Stderr = &amp;stderr</span><br><span class="line">	buffer := bytes.Buffer&#123;&#125;</span><br><span class="line">	buffer.Write([]<span class="type">byte</span>(<span class="string">&quot;ZhangJian&quot;</span>))</span><br><span class="line">	cmd.Stdin = &amp;buffer</span><br><span class="line">	err = cmd.Run()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	outStr, errStr := <span class="type">string</span>(stdout.Bytes()), <span class="type">string</span>(stderr.Bytes())</span><br><span class="line">	fmt.Println(<span class="string">&quot;output is &quot;</span>, outStr)</span><br><span class="line">	fmt.Println(<span class="string">&quot;err output is &quot;</span>, errStr)</span><br><span class="line">	fmt.Println(<span class="string">&quot;Execute Over&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=== RUN   TestCallInteractiveShell</span><br><span class="line">output is  Your password is:  ZhangJian</span><br><span class="line"></span><br><span class="line">err output is  </span><br><span class="line">Execute Over</span><br><span class="line">--- PASS: TestCallInteractiveShell (0.00s)</span><br><span class="line">PASS</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hezhangjian.com/2021/11/29/Zookeeper%20%E9%85%8D%E7%BD%AETLS%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangjian He">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/29/Zookeeper%20%E9%85%8D%E7%BD%AETLS%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81/" class="post-title-link" itemprop="url">Zookeeper é…ç½®TLSå®‰å…¨è®¤è¯</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-11-29 18:22:58" itemprop="dateCreated datePublished" datetime="2021-11-29T18:22:58+08:00">2021-11-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-21 20:55:02" itemprop="dateModified" datetime="2025-10-21T20:55:02+08:00">2025-10-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Javaç³»çš„TLSä¸€èˆ¬éƒ½ä¼šè¦è¿™ä¹ˆå‡ ä¸ªå‚æ•°</p>
<ul>
<li>client.keystore</li>
<li>client.truststore</li>
<li>client.password</li>
<li>server.keystore</li>
<li>server.truststore</li>
<li>server.password</li>
</ul>
<h3 id="ç”Ÿæˆè¯ä¹¦"><a href="#ç”Ÿæˆè¯ä¹¦" class="headerlink" title="ç”Ÿæˆè¯ä¹¦"></a>ç”Ÿæˆè¯ä¹¦</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">client_pass=zk_client_pwd</span><br><span class="line">server_pass=zk_server_pwd</span><br><span class="line">server_dname=<span class="string">&quot;C=CN,ST=GD,L=SZ,O=sh,OU=sh,CN=hezhangjian&quot;</span></span><br><span class="line">client_dname=<span class="string">&quot;C=CN,ST=GD,L=SZ,O=sh,OU=sh,CN=hezhangjian&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;generate client keystore&quot;</span></span><br><span class="line">keytool -genkeypair -keypass <span class="variable">$client_pass</span> -storepass <span class="variable">$client_pass</span> -dname <span class="variable">$client_dname</span> -keyalg RSA -keysize 2048 -validity 3650 -keystore zk_client_key.jks</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;generate server keystore&quot;</span></span><br><span class="line">keytool -genkeypair -keypass <span class="variable">$server_pass</span> -storepass <span class="variable">$server_pass</span> -dname <span class="variable">$server_dname</span> -keyalg RSA -keysize 2048 -validity 3650 -keystore zk_server_key.jks</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export server certificate&quot;</span></span><br><span class="line">keytool -exportcert -keystore zk_server_key.jks -file server.cer -storepass <span class="variable">$server_pass</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export client certificate&quot;</span></span><br><span class="line">keytool -exportcert -keystore zk_client_key.jks -file client.cer -storepass <span class="variable">$client_pass</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;add server cert to client trust keystore&quot;</span></span><br><span class="line">keytool -importcert -keystore zk_client_trust.jks -file server.cer -storepass <span class="variable">$client_pass</span> -noprompt</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;add client cert to server trust keystore&quot;</span></span><br><span class="line">keytool -importcert -keystore zk_server_trust.jks -file client.cer -storepass <span class="variable">$server_pass</span> -noprompt</span><br><span class="line"><span class="built_in">rm</span> -f server.cer</span><br><span class="line"><span class="built_in">rm</span> -f client.cer</span><br></pre></td></tr></table></figure>

<h3 id="æ·»åŠ ZooKeeperé…ç½®"><a href="#æ·»åŠ ZooKeeperé…ç½®" class="headerlink" title="æ·»åŠ ZooKeeperé…ç½®"></a>æ·»åŠ ZooKeeperé…ç½®</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">secureClientPort</span>=<span class="string">2182</span></span><br></pre></td></tr></table></figure>



<h3 id="æœåŠ¡ç«¯å¯åŠ¨"><a href="#æœåŠ¡ç«¯å¯åŠ¨" class="headerlink" title="æœåŠ¡ç«¯å¯åŠ¨"></a>æœåŠ¡ç«¯å¯åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> SERVER_JVMFLAGS=<span class="string">&quot;</span></span><br><span class="line"><span class="string">-Dzookeeper.serverCnxnFactory=org.apache.zookeeper.server.NettyServerCnxnFactory</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.keyStore.location=<span class="variable">$CERT_DIR</span>/zk_server_key.jks</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.keyStore.password=zk_server_pwd</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.trustStore.location=<span class="variable">$CERT_DIR</span>/zk_server_trust.jks</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.trustStore.password=zk_server_pwd&quot;</span></span><br><span class="line">/bin/bash <span class="variable">$ZOOKEEPER_HOME</span>/bin/zkServer.sh start</span><br></pre></td></tr></table></figure>

<h3 id="å®¢æˆ·ç«¯å¯åŠ¨"><a href="#å®¢æˆ·ç«¯å¯åŠ¨" class="headerlink" title="å®¢æˆ·ç«¯å¯åŠ¨"></a>å®¢æˆ·ç«¯å¯åŠ¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> CLIENT_JVMFLAGS=<span class="string">&quot;</span></span><br><span class="line"><span class="string">-Dzookeeper.clientCnxnSocket=org.apache.zookeeper.ClientCnxnSocketNetty</span></span><br><span class="line"><span class="string">-Dzookeeper.client.secure=true</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.hostnameVerification=false</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.keyStore.location=<span class="variable">$CERT_DIR</span>/zk_client_key.jks</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.keyStore.password=zk_client_pwd</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.trustStore.location=<span class="variable">$CERT_DIR</span>/zk_client_trust.jks</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.trustStore.password=zk_client_pwd&quot;</span></span><br><span class="line">bin/zkCli.sh -server localhost:2182</span><br></pre></td></tr></table></figure>

<h3 id="å¯åŠ¨æˆåŠŸ"><a href="#å¯åŠ¨æˆåŠŸ" class="headerlink" title="å¯åŠ¨æˆåŠŸ"></a>å¯åŠ¨æˆåŠŸ</h3><p><img src="/Images/zookeeper-tls.png" alt="image-20211129182141882"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hezhangjian.com/2021/11/02/%E4%BC%98%E7%A7%80%E5%AE%9E%E8%B7%B5%E4%B9%8B%E7%94%A8%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%B5%8B%E8%AF%95%E4%B8%8B%E5%B1%82%E4%BE%9D%E8%B5%96%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangjian He">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/02/%E4%BC%98%E7%A7%80%E5%AE%9E%E8%B7%B5%E4%B9%8B%E7%94%A8%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%B5%8B%E8%AF%95%E4%B8%8B%E5%B1%82%E4%BE%9D%E8%B5%96%E7%9A%84%E9%BB%98%E8%AE%A4%E5%80%BC/" class="post-title-link" itemprop="url">ä¼˜ç§€å®è·µä¹‹ç”¨å•å…ƒæµ‹è¯•æµ‹è¯•ä¸‹å±‚ä¾èµ–çš„é»˜è®¤å€¼</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-11-02 13:10:44" itemprop="dateCreated datePublished" datetime="2021-11-02T13:10:44+08:00">2021-11-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-21 20:55:02" itemprop="dateModified" datetime="2025-10-21T20:55:02+08:00">2025-10-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>è¿™äº›å¤©ï¼Œåœ¨ç»™é¡¹ç›®<strong>servicecomb</strong>æäº¤ä»£ç ï¼Œå‡çº§å…¶ä¸­çš„<code>vertx</code>å’Œ<code>netty</code>ç‰ˆæœ¬å·ï¼Œå‘ç°æœ‰å•å…ƒæµ‹è¯•ç”¨ä¾‹è·‘ä¸è¿‡</p>
<p><a target="_blank" rel="noopener" href="https://github.com/apache/servicecomb-java-chassis/pull/2614">https://github.com/apache/servicecomb-java-chassis/pull/2614</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetMaxFormAttributeSize</span><span class="params">()</span> &#123;</span><br><span class="line">  Assert.assertEquals(<span class="number">8192</span>, TransportConfig.getMaxFormAttributeSize());</span><br><span class="line">  ArchaiusUtils.setProperty(<span class="string">&quot;servicecomb.rest.server.maxFormAttributeSize&quot;</span>, <span class="number">3072</span>);</span><br><span class="line">  Assert.assertEquals(<span class="number">3072</span>, TransportConfig.getMaxFormAttributeSize());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿™ä¸ªç”¨ä¾‹å¯ä»¥æ‹¦æˆªï¼Œå¦‚æœæ–°ç‰ˆæœ¬<strong>TransportConfig</strong>ä¸­ä¾èµ–çš„åº•å±‚é»˜è®¤å€¼ä¿®æ”¹ä¸ºé8192çš„é—®é¢˜ã€‚</p>
<p>å¯¹äºåº•å±‚ä¾èµ–çš„å…¶ä»–é¡¹ç›®ï¼Œæœ‰äº›å‚æ•°æœ‰ç»Ÿä¸€çš„æ–‡ä»¶æ”¾ç½®ï¼Œç”šè‡³æœ‰äº›é¡¹ç›®ï¼Œå‚æ•°åˆ†æ•£åœ¨å„ä¸ªæ–‡ä»¶ã€‚ç›¸æ¯”å‡çº§åï¼Œé€ä¸ªå‚æ•°æ£€æŸ¥ï¼Œé€šè¿‡å•å…ƒæµ‹è¯•èƒ½æ›´æœ‰æ•ˆçš„å‘ç°é»˜è®¤å€¼çš„å˜åŒ–æˆ–ç§»åŠ¨å†å¤„ç†ã€‚æˆ‘è§‰å¾—è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®è·µã€‚æ¨å¹¿åˆ°élibraryåº“ä¸­ï¼Œæˆ‘ä»¬ç»´æŠ¤çš„pulsarã€mysqlç­‰ç»„ä»¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡utæµ‹è¯•æ¥ä¿è¯ä¸€äº›é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤å‚æ•°æ²¡æœ‰æ–°å¢ã€åˆ é™¤æˆ–ä¿®æ”¹ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hezhangjian.com/2021/10/31/%E8%87%AA%E4%B8%8A%E8%80%8C%E4%B8%8B%E7%9A%84%E5%AE%89%E5%85%A8%E8%AE%BE%E8%AE%A1%EF%BC%88%E4%B8%80%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangjian He">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/31/%E8%87%AA%E4%B8%8A%E8%80%8C%E4%B8%8B%E7%9A%84%E5%AE%89%E5%85%A8%E8%AE%BE%E8%AE%A1%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-title-link" itemprop="url">è‡ªä¸Šè€Œä¸‹çš„å®‰å…¨è®¾è®¡ï¼ˆä¸€ï¼‰</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-10-31 16:11:00" itemprop="dateCreated datePublished" datetime="2021-10-31T16:11:00+08:00">2021-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-21 20:55:02" itemprop="dateModified" datetime="2025-10-21T20:55:02+08:00">2025-10-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>è¿™æ˜¯è¿‘æœŸè§‚æ‘©æŸä¸ªäº§å“å®‰å…¨åŠ å›ºæ—¶çš„å¿ƒå¾—ï¼Œä¹Ÿè¯·æ•™è¿‡æˆ‘ä»¬éƒ¨é—¨çš„å®‰å…¨ä¸“å®¶ã€æ¶æ„å¸ˆã€‚ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘æƒ³å…ˆåˆ†æä¸€ä¸‹é‡è¦æ€§å’Œæˆ‘å¿ƒä¸­çš„å®ç°åŸåˆ™ã€‚åé¢å¯ä»¥è´´å‡ºä¸€äº›æ›´è¯¦ç»†çš„æµç¨‹å’Œä»£ç æ ·ä¾‹</p>
<h2 id="æ—©æœŸæ²¡æœ‰åšå¥½å®‰å…¨ï¼Œåæœå¾ˆä¸¥é‡"><a href="#æ—©æœŸæ²¡æœ‰åšå¥½å®‰å…¨ï¼Œåæœå¾ˆä¸¥é‡" class="headerlink" title="æ—©æœŸæ²¡æœ‰åšå¥½å®‰å…¨ï¼Œåæœå¾ˆä¸¥é‡"></a>æ—©æœŸæ²¡æœ‰åšå¥½å®‰å…¨ï¼Œåæœå¾ˆä¸¥é‡</h2><p>ææ—å³°è€å¸ˆï¼Œä¹Ÿå°±æ˜¯ã€ŠNettyæƒå¨æŒ‡å—ã€‹çš„ä½œè€…ï¼ŒåŒæ ·ä¹Ÿåœ¨åä¸ºå·¥ä½œ :)<br>ã€‚åœ¨ä¸€æœ¬ä¹¦å°±æ›¾å†™è¿‡ï¼Œè§è¿‡å¾ˆå¤šäº§å“åœ¨å®‰å…¨å®¡æ ¸ä¸ŠæŠ•å…¥äº†å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›ã€‚æˆ‘è¡¨ç¤ºæ·±æ·±åœ°è®¤åŒã€‚è€Œè¿™äº›ï¼Œå¾€å¾€æ˜¯å› ä¸ºäº§å“åœ¨åˆæœŸæ²¡æœ‰åšå¥½å¥½çš„å®‰å…¨è®¾è®¡ã€‚ä»¥ä¸€ä¸ªå‡æƒ³äº§å“ä¸¾ä¾‹ï¼Œ</p>
<p><img src="/Images/security-design.png" alt="image-20211031152752639"></p>
<p>å›¾ä¸­ï¼ŒAä¸Bä¹‹é—´ï¼ŒAä¸é…ç½®ä¸­å¿ƒä¹‹å‰ï¼Œéƒ½å­˜åœ¨æ”¾ç½®æ•æ„Ÿä¿¡æ¯çš„å¯èƒ½ã€‚æœ‰æ„æ€çš„äº‹æƒ…æ¥äº†ï¼Œå½“å®‰å…¨åˆ†æå‘ç°äº†Aä¸Bä¹‹å‰å­˜åœ¨æ”¾ç½®æ•æ„Ÿä¿¡æ¯çš„å¯èƒ½æ—¶ï¼Œäº§å“å†³å®šæŠŠAä¸Mysqlä¹‹é—´çš„é€šä¿¡è¿›è¡ŒåŠ å¯†å’Œè®¤è¯ï¼ŒåŠ å¯†çš„æºææ–™æ”¾åœ¨å“ªï¼Ÿå†³ç­–æ”¾åˆ°é…ç½®ä¸­å¿ƒã€‚å¯æ˜¯ï¼Œå½“å®‰å…¨åˆ†æå‘ç°Aä¸é…ç½®ä¸­å¿ƒä¹‹é—´å­˜åœ¨ä¼ é€’æ•æ„Ÿä¿¡æ¯çš„å¯èƒ½æ—¶ï¼Ÿé‚£äº§å“åˆåº”è¯¥æ€ä¹ˆåšï¼Ÿæ€»ä¸èƒ½æ”¾åœ¨Mysqlè¿™é‡Œå§ã€‚</p>
<p>ç”±æ­¤å¯è§ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªå®Œå–„çš„ä»ä¸Šè€Œä¸‹çš„å®‰å…¨è®¾è®¡ï¼Œäº§å“åœ¨æå®‰å…¨å¢å¼ºæˆ–è€…è¯´åŠ å›ºçš„æ—¶å€™ï¼Œå°±åƒå“ªé‡Œç ´äº†åˆ·å“ªé‡Œä¸€æ ·ï¼ŒæŠŠæˆ¿é—´å¼„å¾—ä¹±ä¸ƒå…«ç³Ÿï¼Œäº‹å€åŠŸåŠã€‚æˆ‘ç›¸ä¿¡æ›´éš¾å—çš„æ˜¯é‚£äº›åˆ·å¢™çš„å¼€å‘äººå‘˜ã€‚</p>
<h2 id="è‡ªä¸Šè€Œä¸‹å®‰å…¨è®¾è®¡çš„æ ¸å¿ƒ"><a href="#è‡ªä¸Šè€Œä¸‹å®‰å…¨è®¾è®¡çš„æ ¸å¿ƒ" class="headerlink" title="è‡ªä¸Šè€Œä¸‹å®‰å…¨è®¾è®¡çš„æ ¸å¿ƒ"></a>è‡ªä¸Šè€Œä¸‹å®‰å…¨è®¾è®¡çš„æ ¸å¿ƒ</h2><p>ä½œä¸ºä¸€ä¸ªå¼€å‘äººå‘˜ï¼Œæˆ‘è¿˜æ˜¯ç«™åœ¨å¼€å‘äººå‘˜çš„è§’åº¦ã€‚æˆ‘è®¤ä¸ºå¯¹äºå¼€å‘äººå‘˜çš„æ ¸å¿ƒå°±æ˜¯æœ‰ä¸€ä¸ª è¯ä¹¦å¯è½®æ¢ã€å¯†é’¥å¯è½®æ¢çš„åŸºç¡€æœºåˆ¶ã€‚æ¯•ç«Ÿå¼€å‘äººå‘˜æœ€å¸¸ç¢°åˆ°çš„å®‰å…¨é—®é¢˜å°±æ˜¯ï¼š</p>
<ul>
<li>é€šä¿¡ä¸­æ•æ„Ÿæ•°æ®æ²¡æœ‰åŠ å¯†</li>
<li>é€šä¿¡ä¸­åŒæ–¹æ²¡æœ‰åšè®¤è¯</li>
<li>æ•æ„Ÿä¿¡æ¯å­˜å‚¨æ²¡æœ‰åŠ å¯†</li>
</ul>
<p>æ‹¥æœ‰äº†è¯ä¹¦å¯è½®æ¢ã€å¯†é’¥å¯è½®æ¢çš„æœºåˆ¶ï¼Œå¼€å‘äººå‘˜å°±å¯ä»¥è½»è€Œæ˜“ä¸¾åœ°æå®šè¿™ä¸‰ä»¶äº‹æƒ…ã€‚</p>
<h3 id="ä»è®¾è®¡ã€å¼€å‘äººå‘˜çš„æ€ç»´ã€åº•å±‚åº“å¼€å§‹ï¼Œè¯ä¹¦ã€å¯†é’¥éƒ½æ˜¯æ”¯æŒå¯æ›¿æ¢çš„"><a href="#ä»è®¾è®¡ã€å¼€å‘äººå‘˜çš„æ€ç»´ã€åº•å±‚åº“å¼€å§‹ï¼Œè¯ä¹¦ã€å¯†é’¥éƒ½æ˜¯æ”¯æŒå¯æ›¿æ¢çš„" class="headerlink" title="ä»è®¾è®¡ã€å¼€å‘äººå‘˜çš„æ€ç»´ã€åº•å±‚åº“å¼€å§‹ï¼Œè¯ä¹¦ã€å¯†é’¥éƒ½æ˜¯æ”¯æŒå¯æ›¿æ¢çš„"></a>ä»è®¾è®¡ã€å¼€å‘äººå‘˜çš„æ€ç»´ã€åº•å±‚åº“å¼€å§‹ï¼Œè¯ä¹¦ã€å¯†é’¥éƒ½æ˜¯æ”¯æŒå¯æ›¿æ¢çš„</h3><ul>
<li>åº•å±‚åº“æ”¯æŒè¯ä¹¦è½®æ¢ã€å¯†é’¥è½®æ¢ï¼ŒåŒæ—¶æ³¨æ„è½®æ¢æ—¶è€å¯†é’¥çš„å­˜ç•™æ—¶é—´ç­‰</li>
<li>å¯†é’¥æ›´æ–°æ—¶ï¼Œå¦‚æœéœ€è¦å½»åº•åºŸå¼ƒè€å¯†é’¥ï¼Œæ³¨æ„æ—§æ•°æ®éœ€è¦é‡æ–°è§£å¯†åç”¨æ–°å¯†é’¥åŠ å¯†</li>
<li>å¼€å‘äººå‘˜ä¹Ÿè¦è®¤åŒå¯†é’¥æ˜¯å¯æ›¿æ¢çš„ï¼Œç”šè‡³ä¸åŒç”¨æˆ·çš„å¯†é’¥å¯ä»¥æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸ç„¶å¦‚æœå¹³æ—¶æµ‹è¯•è¦†ç›–ä¸åˆ°å¯†é’¥æ›¿æ¢ï¼ŒçœŸæ­£å®æ–½çš„è¯ï¼Œå°±ä¼šä¸æ•¢å®æ–½ï¼Œæˆ–è€…å‡ºç°ç°ç½‘äº‹æ•…</li>
</ul>
<h3 id="è¯ä¹¦ã€å¯†é’¥çš„å­˜å‚¨"><a href="#è¯ä¹¦ã€å¯†é’¥çš„å­˜å‚¨" class="headerlink" title="è¯ä¹¦ã€å¯†é’¥çš„å­˜å‚¨"></a>è¯ä¹¦ã€å¯†é’¥çš„å­˜å‚¨</h3><p>å¾€å¾€ï¼Œæˆ‘ä»¬å¼€å‘çš„ä»»æ„ä¸¤ä¸ªç»„ä»¶ä¹‹é—´ï¼Œéƒ½å¯èƒ½ä¼šè¦æ±‚äº’ç›¸é€šä¿¡å’Œè®¤è¯ï¼Œæ›´ä¸ç”¨æé‚£äº›åˆå§‹å£ä»¤äº†ï¼Œè‚¯å®šæ˜¯éœ€è¦åŠ å¯†çš„ï¼Œæ‰€ä»¥è¯ä¹¦å’Œå¯†é’¥ä¸é€‚åˆå­˜åœ¨äº§å“è‡ªå·±å¼€å‘çš„é…ç½®ä¸­å¿ƒï¼Œæˆ–è€…æ˜¯æ•°æ®åº“ä¸­ã€‚æ›´é€‚åˆåœ¨å®‰è£…éƒ¨ç½²é˜¶æ®µæ”¾ç½®åœ¨æ›´åº•å±‚ï¼Œæ›´åŸºç¡€è®¾æ–½ä¸­ï¼Œä¾‹å¦‚</p>
<ul>
<li>ä¸“ç”¨çš„åŠ å¯†ç¡¬ä»¶</li>
<li>ä¾èµ–å…¬æœ‰äº‘è¿›è¡Œéƒ¨ç½²çš„ï¼Œå¯ä»¥å°†è¯ä¹¦å­˜æ”¾åœ¨äº‘ä¸Šæ‰˜ç®¡çš„Kubernetesé›†ç¾¤çš„secretä¸­ï¼Œå¹¶å¯¹k8sé›†ç¾¤è¿›è¡ŒåŠ å›ºï¼Œé¿å…æ ¹å¯†é’¥ã€æ ¹è¯ä¹¦æ³„éœ²</li>
</ul>
<p>è¿™äº›éƒ½å¯ä»¥ç”±éƒ¨ç½²å·¥å…·è‡ªåŠ¨å¯¼å…¥æˆ–äººå·¥æ‰‹åŠ¨å¯¼å…¥ã€‚</p>
<h3 id="è®¾è®¡è¯ä¹¦ã€å¯†é’¥çš„ä½¿ç”¨è½®æ¢æœºåˆ¶"><a href="#è®¾è®¡è¯ä¹¦ã€å¯†é’¥çš„ä½¿ç”¨è½®æ¢æœºåˆ¶" class="headerlink" title="è®¾è®¡è¯ä¹¦ã€å¯†é’¥çš„ä½¿ç”¨è½®æ¢æœºåˆ¶"></a>è®¾è®¡è¯ä¹¦ã€å¯†é’¥çš„ä½¿ç”¨è½®æ¢æœºåˆ¶</h3><ul>
<li>è¯ä¹¦çš„ç²’åº¦ï¼šæ˜¯æ¯ä¸ªå¾®æœåŠ¡ä¸€ä¸ªè¯ä¹¦è¿˜æ˜¯æ¯ä¸ªä¸šåŠ¡åœºæ™¯ä¸€ä¸ªè¯ä¹¦</li>
<li>å¯†é’¥çš„ç²’åº¦ï¼šæ˜¯æ¯ä¸ªå®¢æˆ·ä¸€ä¸ªå·¥ä½œå¯†é’¥è¿˜æ˜¯å…±äº«ä¸€ä¸ªå·¥ä½œå¯†é’¥</li>
<li>è½®æ¢æ—¶æ˜¯å¦å®¹å¿ä¸šåŠ¡æŸå¤±ï¼Œæœ€å¤§å¯æŸå¤±æ—¶é•¿æ˜¯å¤šä¹…</li>
<li>è¿˜è¦æ³¨æ„æ¯ä¸ªå¾®æœåŠ¡èƒ½è·å–åˆ°çš„è¯ä¹¦å’Œå¯†é’¥ï¼Œå®ƒåªåº”è¯¥è·å–å®ƒéœ€è¦çš„è¯ä¹¦ã€å¯†é’¥ï¼Œç†è®ºä¸Šå•ä¸€å¾®æœåŠ¡ä¸åº”è¯¥æœ‰è·å–æ ¹è¯ä¹¦ã€æ ¹å¯†é’¥çš„èƒ½åŠ›ã€‚</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hezhangjian.com/2021/10/20/Cassandra%E4%B8%AD%E7%9A%84Primary%20Key%E3%80%81Partition%20Key%E3%80%81Clustering%20Key%E9%83%BD%E6%98%AF%E4%BB%80%E4%B9%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangjian He">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/20/Cassandra%E4%B8%AD%E7%9A%84Primary%20Key%E3%80%81Partition%20Key%E3%80%81Clustering%20Key%E9%83%BD%E6%98%AF%E4%BB%80%E4%B9%88/" class="post-title-link" itemprop="url">Cassandraä¸­çš„Primary Keyã€Partition Keyã€Clustering Keyéƒ½æ˜¯ä»€ä¹ˆï¼Ÿ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-10-20 20:36:27" itemprop="dateCreated datePublished" datetime="2021-10-20T20:36:27+08:00">2021-10-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-21 20:55:02" itemprop="dateModified" datetime="2025-10-21T20:55:02+08:00">2025-10-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Cassandraä¸­çš„Keyæœ‰å¦‚ä¸‹ä¸‰ç§ç±»å‹</p>
<ul>
<li>Primary Key</li>
<li>Partitioning Key</li>
<li>Clustering Key</li>
</ul>
<h2 id="Primary-Key-ä¸»é”®"><a href="#Primary-Key-ä¸»é”®" class="headerlink" title="Primary Key ä¸»é”®"></a>Primary Key ä¸»é”®</h2><p>æ¯å¼ è¡¨éƒ½éœ€è¦æœ‰ä¸»é”®ã€‚ä¸»é”®å¯ä»¥æ˜¯ä¸€ä¸ªå­—æ®µæˆ–è€…å¤šä¸ªå­—æ®µçš„ç»„åˆã€‚æ¯æ¡è®°å½•çš„ä¸»é”®å¿…é¡»å”¯ä¸€ã€‚ä¸¾ä¸ªä¾‹å­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE player (</span><br><span class="line">   name text,</span><br><span class="line">   club text,</span><br><span class="line">   league text,</span><br><span class="line">   nationality text,</span><br><span class="line">	 kit_number text,</span><br><span class="line">   position text,</span><br><span class="line">	 goals int,</span><br><span class="line">   assists int,</span><br><span class="line">   appearences int,</span><br><span class="line">   PRIMARY KEY (club, league, name, kit_number, position, goals)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ•°æ®è¡¨çš„ä¸»é”®æœ‰å¤šä¸ªå­—æ®µï¼Œç§°åšå¤åˆä¸»é”®ã€‚</p>
<h2 id="åˆ†åŒºé”®"><a href="#åˆ†åŒºé”®" class="headerlink" title="åˆ†åŒºé”®"></a>åˆ†åŒºé”®</h2><p><code>Cassandra</code>æ ¹æ®åˆ†åŒºé”®ï¼Œä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼ŒæŠŠæ•°æ®åˆ†é…åˆ°é›†ç¾¤çš„å„ä¸ªæœºå™¨ä¸Šã€‚ä¸€ä¸ªæœºå™¨å¯ä»¥åŒ…å«å¤šä¸ªåˆ†åŒºã€‚<code>Cassandra</code>ä¿è¯åŒä¸€åˆ†åŒºé”®çš„æ•°æ®éƒ½åœ¨ä¸€å°æœºå™¨ä¸Šã€‚é€šè¿‡åˆç†çš„è®¾ç½®åˆ†åŒºé”®ï¼Œå¯ä»¥è®©ä½ çš„æŸ¥è¯¢è®©å°½é‡å°‘çš„æœºå™¨å¤„ç†ï¼Œæå‡æŸ¥è¯¢çš„æ•ˆç‡</p>
<p>å¯¹äºå•ä¸»é”®å­—æ®µæ¥è¯´ï¼Œåˆ†åŒºé”®å’Œä¸»é”®æ˜¯åŒä¸€ä¸ªå­—æ®µã€‚</p>
<p>å¯¹äºå¤åˆä¸»é”®å­—æ®µæ¥è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ†åŒºé”®æ˜¯å¤åˆä¸»é”®çš„ç¬¬ä¸€ä¸ªå­—æ®µã€‚å¦‚ä¸Šä¾‹ä¸­ï¼Œåˆ†åŒºé”®æ˜¯<code>club</code>å­—æ®µ</p>
<p>å¯ä»¥é€šè¿‡æ‹¬å·æ¥å°†åˆ†åŒºé”®æŒ‡å®šä¸ºå¤šä¸ªå­—æ®µï¼Œå¦‚å°†ä¸Šé¢<code>CQL</code>çš„11è¡Œä¿®æ”¹ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PRIMARY KEY ((name, club), league, kit_number, position, goals)</span><br></pre></td></tr></table></figure>

<h2 id="Clustering-Key"><a href="#Clustering-Key" class="headerlink" title="Clustering Key"></a>Clustering Key</h2><p>Clustering Keyså†³å®šäº†åˆ†åŒºå†…æ•°æ®çš„æ’åºã€‚è®©æˆ‘ä»¬å†çœ‹ä¸€ä¸‹æœ€åˆçš„ä¾‹å­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE player (</span><br><span class="line">   name text,</span><br><span class="line">   club text,</span><br><span class="line">   league text,</span><br><span class="line">   nationality text,</span><br><span class="line">	 kit_number text,</span><br><span class="line">   position text,</span><br><span class="line">	 goals int,</span><br><span class="line">   assists int,</span><br><span class="line">   appearences int,</span><br><span class="line">   PRIMARY KEY (club, league, name, kit_number, position, goals)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸»é”®ä¸­çš„å­—æ®µï¼Œé™¤äº†åˆ†åŒºé”®å¤–éƒ½æ˜¯<strong>clustering key</strong>ã€‚æ—¢ç„¶<code>club</code>æ˜¯ä¸»é”®ï¼Œé‚£ä¹ˆ<code>league name kit_number position goals</code>æ˜¯Clustering keyã€‚ä½ å¯ä»¥å®šä¹‰<strong>clustering key</strong>ä¸­æ¯ä¸ªå­—æ®µçš„å‡é™åºã€‚å¯ä»¥å°†<code>kit_number</code>é™åºã€<code>goals</code>å‡åº</p>
<p>æ’åºé¡ºåºä¸ä¸»é”®ä¸­å­—æ®µçš„é¡ºåºç›¸åŒã€‚å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ•°æ®æ˜¯æŒ‰ç…§å¦‚ä¸‹å¸ƒå±€çš„</p>
<ul>
<li>æ‰€æœ‰ç›¸åŒ<code>club</code>çš„è¿åŠ¨å‘˜éƒ½å°†åˆ†åœ¨åŒä¸€ä¸ªåˆ†åŒº</li>
<li>åœ¨åˆ†åŒºå†…ï¼ŒæŒ‰ç…§<code>leauge</code>æ’åº</li>
<li>ç„¶åæŒ‰ç…§<code>name</code>æ’åº</li>
<li>ç„¶åæŒ‰ç…§<code>kit_number</code>æ’åº</li>
<li>â€¦</li>
</ul>
<p>å®šä¹‰ä¸åŒå­—æ®µå‡é™åºçš„è¯­æ³•å¦‚ä¸‹(é»˜è®¤ä¸ºå‡åº)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE player (</span><br><span class="line">   name text,</span><br><span class="line">   club text,</span><br><span class="line">   league text,</span><br><span class="line">   nationality text,</span><br><span class="line">	 kit_number text,</span><br><span class="line">   position text,</span><br><span class="line">	 goals int,</span><br><span class="line">   assists int,</span><br><span class="line">   appearances int,</span><br><span class="line">   PRIMARY KEY (club, league, name, kit_number, position, goals)</span><br><span class="line">)</span><br><span class="line">WITH CLUSTERING ORDER BY (league ASC, name DESC, kit_number ASC, position DESC );</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hezhangjian.com/2021/10/17/valgrind%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%A3%80%E6%B5%8B%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangjian He">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/17/valgrind%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%A3%80%E6%B5%8B%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/" class="post-title-link" itemprop="url">Valgrindå†…å­˜æ³„æ¼æ£€æµ‹å¿«é€Ÿä¸Šæ‰‹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-10-17 16:13:57" itemprop="dateCreated datePublished" datetime="2021-10-17T16:13:57+08:00">2021-10-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-21 20:55:02" itemprop="dateModified" datetime="2025-10-21T20:55:02+08:00">2025-10-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="å‡†å¤‡è¢«æµ‹ç¨‹åº"><a href="#å‡†å¤‡è¢«æµ‹ç¨‹åº" class="headerlink" title="å‡†å¤‡è¢«æµ‹ç¨‹åº"></a>å‡†å¤‡è¢«æµ‹ç¨‹åº</h2><p>é€šè¿‡<code>-g</code>ç¼–è¯‘ç¨‹åºæ¥æºå¸¦debugä¿¡æ¯ï¼Œè¿™æ ·å­è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯å°±å¯ä»¥åŒ…å«ç²¾ç¡®çš„è¡Œå·ã€‚å¦‚æœä½ å¯ä»¥æ‰¿å—ç¨‹åºè¿è¡Œç¼“æ…¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>-O0</code>æ¥ç¼–è¯‘ç¨‹åºã€‚å¦‚æœä½¿ç”¨<code>-O1</code>ï¼Œé‚£ä¹ˆè¾“å‡ºçš„è¡Œå·å¯èƒ½ä¼šä¸å‡†ç¡®ã€‚ä¸æ¨èä½¿ç”¨<code>-O2</code>åŠä»¥ä¸Šï¼Œå› ä¸º <code>valgrind memcheck</code> å¶å°”ä¼šæŠ¥å‘Šä¸å­˜åœ¨çš„æœªåˆå§‹åŒ–å€¼é”™è¯¯ã€‚</p>
<h2 id="è¿è¡Œç¨‹åº"><a href="#è¿è¡Œç¨‹åº" class="headerlink" title="è¿è¡Œç¨‹åº"></a>è¿è¡Œç¨‹åº</h2><p>å¦‚æœå¹³æ—¶è¿™ä¹ˆè¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myprog arg1 arg2</span><br></pre></td></tr></table></figure>

<p>å°±ä½¿ç”¨è¿™ä¸ªå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">valgrind --leak-check=<span class="built_in">yes</span> myprog arg1 arg2</span><br></pre></td></tr></table></figure>

<p><code>Memcheck</code>æ˜¯é»˜è®¤çš„<code>valgrind</code>å·¥å…·ï¼Œ<code>--leak-check</code>æ‰“å¼€äº†å†…å­˜æ³„æ¼æ£€æµ‹å¼€å…³ã€‚</p>
<p>é€šè¿‡è¿™ä¸ªå‘½ä»¤è¿è¡Œï¼Œå¤§çº¦ä¼šæ¯”å¹³æ—¶è¿è¡Œæ…¢20åˆ°30å€ï¼Œå¹¶ä¸”ä½¿ç”¨æ›´å¤§çš„å†…å­˜ã€‚Memcheck å°†å‘å‡ºå®ƒæ£€æµ‹åˆ°çš„å†…å­˜é”™è¯¯å’Œæ³„æ¼çš„ä¿¡æ¯ã€‚</p>
<h2 id="è§£é‡Šmemcheckçš„è¾“å‡º"><a href="#è§£é‡Šmemcheckçš„è¾“å‡º" class="headerlink" title="è§£é‡Šmemcheckçš„è¾“å‡º"></a>è§£é‡Š<code>memcheck</code>çš„è¾“å‡º</h2><p>ä½¿ç”¨æ ·ä¾‹çš„Cç¨‹åºï¼ŒåŒ…å«ä¸€ä¸ªå†…å­˜åˆ†é…é”™è¯¯å’Œå†…å­˜æº¢å‡º</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">f</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="type">int</span>* x = <span class="built_in">malloc</span>(<span class="number">10</span> * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">   x[<span class="number">10</span>] = <span class="number">0</span>;        <span class="comment">// problem 1: heap block overrun</span></span><br><span class="line">&#125;                    <span class="comment">// problem 2: memory leak -- x not freed</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">   f();</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå†…å­˜æ£€æµ‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -g demo.c</span><br><span class="line">valgrind ./a.out</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºä¿¡æ¯å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">==145== Memcheck, a memory error detector</span><br><span class="line">==145== Copyright (C) 2002-2017, and GNU GPL&#x27;d, by Julian Seward et al.</span><br><span class="line">==145== Using Valgrind-3.17.0 and LibVEX; rerun with -h for copyright info</span><br><span class="line">==145== Command: ./a.out</span><br><span class="line">==145==</span><br><span class="line">==145== Invalid write of size 4</span><br><span class="line">==145==    at 0x401144: f (demo.c:6)</span><br><span class="line">==145==    by 0x401155: main (demo.c:11)</span><br><span class="line">==145==  Address 0x4a27068 is 0 bytes after a block of size 40 alloc&#x27;d</span><br><span class="line">==145==    at 0x484086F: malloc (vg_replace_malloc.c:380)</span><br><span class="line">==145==    by 0x401137: f (demo.c:5)</span><br><span class="line">==145==    by 0x401155: main (demo.c:11)</span><br><span class="line">==145==</span><br><span class="line">==145==</span><br><span class="line">==145== HEAP SUMMARY:</span><br><span class="line">==145==     in use at exit: 40 bytes in 1 blocks</span><br><span class="line">==145==   total heap usage: 1 allocs, 0 frees, 40 bytes allocated</span><br><span class="line">==145==</span><br><span class="line">==145== 40 bytes in 1 blocks are definitely lost in loss record 1 of 1</span><br><span class="line">==145==    at 0x484086F: malloc (vg_replace_malloc.c:380)</span><br><span class="line">==145==    by 0x401137: f (demo.c:5)</span><br><span class="line">==145==    by 0x401155: main (demo.c:11)</span><br><span class="line">==145==</span><br><span class="line">==145== LEAK SUMMARY:</span><br><span class="line">==145==    definitely lost: 40 bytes in 1 blocks</span><br><span class="line">==145==    indirectly lost: 0 bytes in 0 blocks</span><br><span class="line">==145==      possibly lost: 0 bytes in 0 blocks</span><br><span class="line">==145==    still reachable: 0 bytes in 0 blocks</span><br><span class="line">==145==         suppressed: 0 bytes in 0 blocks</span><br><span class="line">==145==</span><br><span class="line">==145== For lists of detected and suppressed errors, rerun with: -s</span><br><span class="line">==145== ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 0 from 0)</span><br></pre></td></tr></table></figure>

<ul>
<li>145 æ˜¯è¿›ç¨‹å·</li>
<li>è¾“å‡ºçš„ç¬¬ä¸€è¡Œï¼Œå³ä¸Šæ–¹çš„ç¬¬å…­è¡Œ(<code>Invalid write</code>)è¡¨æ˜äº†é”™è¯¯çš„ç±»å‹ã€‚è¿™é‡Œç¨‹åºå¾€ä¸å½’å®ƒæ‹¥æœ‰çš„å†…å­˜ä¸­å†™å…¥äº†ä¿¡æ¯</li>
<li>ä¸‹æ–¹æ˜¯é”™è¯¯çš„å †æ ˆä¿¡æ¯</li>
<li>ä»£ç åœ°å€å¦‚<code>0x401155</code>é€šå¸¸å¹¶ä¸é‡è¦ï¼Œä½†æœ‰æ—¶å€™å®šä½å¥‡æ€ªçš„é—®é¢˜å¯èƒ½ä¼šå¾ˆå…³é”®</li>
<li>ä¸€äº›é”™è¯¯ä¿¡æ¯ä¼šæœ‰ç¬¬äºŒæ®µï¼Œç”¨æ¥æè¿°æ‰€æ¶‰åŠçš„å†…å­˜åœ°å€ã€‚ä¸Šä¾‹æŒ‡å‡ºå†™å…¥çš„å†…å­˜åˆšå¥½è¶…è¿‡ example.c çš„ç¬¬ 5 è¡Œä½¿ç”¨ malloc() åˆ†é…çš„å—çš„æœ«å°¾ã€‚</li>
</ul>
<h3 id="å†…å­˜æ³„æ¼ä¿¡æ¯"><a href="#å†…å­˜æ³„æ¼ä¿¡æ¯" class="headerlink" title="å†…å­˜æ³„æ¼ä¿¡æ¯"></a>å†…å­˜æ³„æ¼ä¿¡æ¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">==145== 40 bytes in 1 blocks are definitely lost in loss record 1 of 1</span><br><span class="line">==145==    at 0x484086F: malloc (vg_replace_malloc.c:380)</span><br><span class="line">==145==    by 0x401137: f (demo.c:5)</span><br><span class="line">==145==    by 0x401155: main (demo.c:11)</span><br></pre></td></tr></table></figure>

<p>å †æ ˆå¯ä»¥è¡¨æ˜ä»€ä¹ˆå†…å­˜æ³„éœ²äº†ï¼Œä½†<code>memcheck</code>å¹¶ä¸èƒ½å‘Šè¯‰ä½ å†…å­˜æ³„æ¼çš„åŸå› </p>
<p>valgrindä¼šæç¤ºä¸¤ç§å†…å­˜æ³„æ¼</p>
<ul>
<li>â€œdefinitely lostâ€: ç»å¯¹æ³„æ¼äº†å†…å­˜ï¼Œå¿…é¡»ä¿®å¤</li>
<li>â€œprobably lostâ€:  ç¨‹åºå¯èƒ½æ³„æ¼äº†å†…å­˜ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸€äº›ç‰¹å®šçš„æŒ‡é’ˆæ“ä½œï¼ˆå¦‚ï¼šæŒ‡é’ˆæ”¾åˆ°äº†å †ä¸­ï¼‰</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://www.valgrind.org/docs/manual/quick-start.html#quick-start.intro">https://www.valgrind.org/docs/manual/quick-start.html#quick-start.intro</a></p>
<p><a target="_blank" rel="noopener" href="https://www.valgrind.org/docs/manual/mc-manual.html#mc-manual.errormsgs">https://www.valgrind.org/docs/manual/mc-manual.html#mc-manual.errormsgs</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hezhangjian.com/2021/10/16/MySQL%E7%94%9F%E6%88%90%20core%20dump%E6%96%87%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangjian He">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/16/MySQL%E7%94%9F%E6%88%90%20core%20dump%E6%96%87%E4%BB%B6/" class="post-title-link" itemprop="url">MySQLç”Ÿæˆ core dumpæ–‡ä»¶</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-10-16 23:32:43" itemprop="dateCreated datePublished" datetime="2021-10-16T23:32:43+08:00">2021-10-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-21 20:55:02" itemprop="dateModified" datetime="2025-10-21T20:55:02+08:00">2025-10-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="å‰ææ¡ä»¶"><a href="#å‰ææ¡ä»¶" class="headerlink" title="å‰ææ¡ä»¶"></a>å‰ææ¡ä»¶</h2><h2 id="æ·»åŠ é…ç½®"><a href="#æ·»åŠ é…ç½®" class="headerlink" title="æ·»åŠ é…ç½®"></a>æ·»åŠ é…ç½®</h2><h3 id="mysqld-ä¸‹é¢æ·»åŠ core-file"><a href="#mysqld-ä¸‹é¢æ·»åŠ core-file" class="headerlink" title="[mysqld]ä¸‹é¢æ·»åŠ core-file"></a>[mysqld]ä¸‹é¢æ·»åŠ <code>core-file</code></h3><p><img src="/Images/mysql-core-dump1.png" alt="image-20211016232603862"></p>
<h3 id="ulimitæ‰“å¼€core-fileé™åˆ¶"><a href="#ulimitæ‰“å¼€core-fileé™åˆ¶" class="headerlink" title="ulimitæ‰“å¼€core fileé™åˆ¶"></a>ulimitæ‰“å¼€core fileé™åˆ¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -c unlimited</span><br></pre></td></tr></table></figure>

<h3 id="å¦‚éœ€è¦ï¼Œä¿®æ”¹core-fileè·¯å¾„ï¼ˆå¦‚åœ¨å®¹å™¨å†…ï¼Œéœ€è¦ç‰¹æƒå®¹å™¨æƒé™ï¼‰"><a href="#å¦‚éœ€è¦ï¼Œä¿®æ”¹core-fileè·¯å¾„ï¼ˆå¦‚åœ¨å®¹å™¨å†…ï¼Œéœ€è¦ç‰¹æƒå®¹å™¨æƒé™ï¼‰" class="headerlink" title="å¦‚éœ€è¦ï¼Œä¿®æ”¹core fileè·¯å¾„ï¼ˆå¦‚åœ¨å®¹å™¨å†…ï¼Œéœ€è¦ç‰¹æƒå®¹å™¨æƒé™ï¼‰"></a>å¦‚éœ€è¦ï¼Œä¿®æ”¹core fileè·¯å¾„ï¼ˆå¦‚åœ¨å®¹å™¨å†…ï¼Œéœ€è¦ç‰¹æƒå®¹å™¨æƒé™ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/opt/sh/mysql/core/core&quot;</span> &gt; /proc/sys/kernel/core_pattern</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿å¾—core-fileæºå¸¦pidä¿¡æ¯"><a href="#ä½¿å¾—core-fileæºå¸¦pidä¿¡æ¯" class="headerlink" title="ä½¿å¾—core fileæºå¸¦pidä¿¡æ¯"></a>ä½¿å¾—core fileæºå¸¦pidä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt;/proc/sys/kernel/core_uses_pid</span><br></pre></td></tr></table></figure>

<h2 id="é€šè¿‡killå‘½ä»¤è·å–core-file"><a href="#é€šè¿‡killå‘½ä»¤è·å–core-file" class="headerlink" title="é€šè¿‡killå‘½ä»¤è·å–core file"></a>é€šè¿‡killå‘½ä»¤è·å–core file</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -11 <span class="variable">$pid</span></span><br></pre></td></tr></table></figure>

<p><img src="/Images/mysql-core-dump2.png" alt="image-20211016233105059"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hezhangjian.com/2021/10/12/%E5%B0%86Rust%E7%A8%8B%E5%BA%8F%E6%89%98%E7%AE%A1%E7%BB%99Systemd%E8%BF%90%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangjian He">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/12/%E5%B0%86Rust%E7%A8%8B%E5%BA%8F%E6%89%98%E7%AE%A1%E7%BB%99Systemd%E8%BF%90%E8%A1%8C/" class="post-title-link" itemprop="url">å°†Rustç¨‹åºæ‰˜ç®¡ç»™Systemdè¿è¡Œ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-10-12 18:25:48" itemprop="dateCreated datePublished" datetime="2021-10-12T18:25:48+08:00">2021-10-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-21 20:55:02" itemprop="dateModified" datetime="2025-10-21T20:55:02+08:00">2025-10-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>å°†ç¨‹åº(ä»¥rustç¨‹åºä¸ºä¾‹)æ‰˜ç®¡ä¸º<code>Systemd</code>è¿è¡Œæ¯”è¾ƒå®¹æ˜“ï¼Œæ­¥éª¤åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥</p>
<ul>
<li>ç”ŸæˆrustäºŒè¿›åˆ¶æ–‡ä»¶</li>
<li>åˆ›å»ºä¸“ç”¨ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼ˆå¯çœç•¥ï¼‰</li>
<li>ä¹¦å†™<code>.service</code>æ–‡ä»¶</li>
<li>é€šè¿‡<code>systemctl</code>å¯åŠ¨</li>
</ul>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä»¥ubuntuã€ç®€å•çš„rust webç¨‹åºä¸ºä¾‹ï¼Œæ¼”ç¤ºä¸€ä¸ªç®€å•çš„<code>rust</code>ç¨‹åºå¦‚ä½•æ‰˜ç®¡ç»™<code>Systemd</code>è¿è¡Œ</p>
<h2 id="ç”ŸæˆrustäºŒè¿›åˆ¶æ–‡ä»¶"><a href="#ç”ŸæˆrustäºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="ç”ŸæˆrustäºŒè¿›åˆ¶æ–‡ä»¶"></a>ç”ŸæˆrustäºŒè¿›åˆ¶æ–‡ä»¶</h2><h3 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tokio = &#123; version = &quot;1&quot;, features = [&quot;full&quot;] &#125;</span><br><span class="line">warp = &quot;0.3&quot;</span><br></pre></td></tr></table></figure>

<h3 id="ä¹¦å†™ç®€å•ä»£ç "><a href="#ä¹¦å†™ç®€å•ä»£ç " class="headerlink" title="ä¹¦å†™ç®€å•ä»£ç "></a>ä¹¦å†™ç®€å•ä»£ç </h3><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> warp::Filter;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[tokio::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// GET /hello/warp =&gt; 200 OK with body &quot;Hello, warp!&quot;</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">hello</span> = warp::path!(<span class="string">&quot;hello&quot;</span> / <span class="type">String</span>)</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|name| <span class="built_in">format!</span>(<span class="string">&quot;Hello, &#123;&#125;!&quot;</span>, name));</span><br><span class="line"></span><br><span class="line">    warp::<span class="title function_ invoke__">serve</span>(hello)</span><br><span class="line">        .<span class="title function_ invoke__">run</span>(([<span class="number">127</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>], <span class="number">3030</span>))</span><br><span class="line">        .<span class="keyword">await</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¯‘ç”ŸæˆäºŒè¿›åˆ¶"><a href="#ç¼–è¯‘ç”ŸæˆäºŒè¿›åˆ¶" class="headerlink" title="ç¼–è¯‘ç”ŸæˆäºŒè¿›åˆ¶"></a>ç¼–è¯‘ç”ŸæˆäºŒè¿›åˆ¶</h3><p><code>cargo build --release</code></p>
<p>äºŒè¿›åˆ¶å°±åœ¨<code>target/release</code>ä¸­</p>
<h2 id="åˆ›å»ºä¸“ç”¨ç”¨æˆ·å’Œç”¨æˆ·ç»„"><a href="#åˆ›å»ºä¸“ç”¨ç”¨æˆ·å’Œç”¨æˆ·ç»„" class="headerlink" title="åˆ›å»ºä¸“ç”¨ç”¨æˆ·å’Œç”¨æˆ·ç»„"></a>åˆ›å»ºä¸“ç”¨ç”¨æˆ·å’Œç”¨æˆ·ç»„</h2><p>ä¸ºäº†æ›´ç»†ç²’åº¦åœ°æˆæƒå’Œæ–‡ä»¶æƒé™æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å®ˆæŠ¤ç¨‹åºåˆ›å»ºä¸“ç”¨çš„ç”¨æˆ·</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> useradd vmproxy -s /sbin/nologin -M</span><br></pre></td></tr></table></figure>



<h2 id="ä¹¦å†™-serviceæ–‡ä»¶"><a href="#ä¹¦å†™-serviceæ–‡ä»¶" class="headerlink" title="ä¹¦å†™.serviceæ–‡ä»¶"></a>ä¹¦å†™<code>.service</code>æ–‡ä»¶</h2><p><code>.service</code>æ–‡ä»¶åœ¨<code>ubuntu</code>åº”è¯¥æ”¾åˆ°<code>/lib/systemd/system/</code>è·¯å¾„ä¸‹ã€‚æ ·ä¾‹å¦‚ä¸‹<code>vm-proxy.service</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Vm Proxy</span><br><span class="line">ConditionPathExists=/home/ubuntu/rust/vm-proxy/target/release/vm-proxy-rust</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=vmproxy</span><br><span class="line">Group=vmproxy</span><br><span class="line">LimitNOFILE=1024</span><br><span class="line"></span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=10</span><br><span class="line"></span><br><span class="line">WorkingDirectory=/home/ubuntu/rust/vm-proxy/target/release</span><br><span class="line">ExecStart=/home/ubuntu/rust/vm-proxy/target/release/vm-proxy-rust</span><br><span class="line"></span><br><span class="line"># make sure log directory exists and owned by syslog</span><br><span class="line">PermissionsStartOnly=true</span><br><span class="line">ExecStartPre=/bin/mkdir -p /var/log/vm-proxy</span><br><span class="line">ExecStartPre=/bin/chown syslog:adm /var/log/vm-proxy</span><br><span class="line">ExecStartPre=/bin/chmod 755 /var/log/vm-proxy</span><br><span class="line">StandardOutput=syslog</span><br><span class="line">StandardError=syslog</span><br><span class="line">SyslogIdentifier=vm-proxy</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p><code>ConditionPathExists</code>ã€<code>WorkingDirectory</code>ã€ <code>ExecStart</code> è¿™ä¸‰ä¸ªå‚æ•°éœ€è¦æ ¹æ®è‡ªå·±çš„è·¯å¾„ä¿®æ”¹</p>
<h2 id="é€šè¿‡Systemctlå¯åŠ¨"><a href="#é€šè¿‡Systemctlå¯åŠ¨" class="headerlink" title="é€šè¿‡Systemctlå¯åŠ¨"></a>é€šè¿‡<code>Systemctl</code>å¯åŠ¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> vm-proxy.service</span><br><span class="line"><span class="built_in">sudo</span> systemctl start vm-proxy.service</span><br></pre></td></tr></table></figure>

<h2 id="éªŒè¯å¯åŠ¨å®Œæˆ"><a href="#éªŒè¯å¯åŠ¨å®Œæˆ" class="headerlink" title="éªŒè¯å¯åŠ¨å®Œæˆ"></a>éªŒè¯å¯åŠ¨å®Œæˆ</h2><p><img src="/Images/rust-systemd1.png" alt="image-20211012165631993"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hezhangjian.com/2021/09/29/%E4%BD%BF%E7%94%A8arthas%E7%94%9F%E6%88%90java%E7%A8%8B%E5%BA%8Fcpu%E7%81%AB%E7%84%B0%E5%9B%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangjian He">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/29/%E4%BD%BF%E7%94%A8arthas%E7%94%9F%E6%88%90java%E7%A8%8B%E5%BA%8Fcpu%E7%81%AB%E7%84%B0%E5%9B%BE/" class="post-title-link" itemprop="url">ä½¿ç”¨arthasç”Ÿæˆjavaç¨‹åºcpuç«ç„°å›¾</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-09-29 15:15:28" itemprop="dateCreated datePublished" datetime="2021-09-29T15:15:28+08:00">2021-09-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-21 20:55:02" itemprop="dateModified" datetime="2025-10-21T20:55:02+08:00">2025-10-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><p>éœ€è¦æœ‰ä¸€ä¸ªè¿è¡Œçš„javaç¨‹åºï¼Œå¦‚æœä½ å·²ç»æœ‰äº†è¿è¡Œä¸­çš„javaç¨‹åºï¼Œè¯·è·³è¿‡è¿™ä¸€èŠ‚ï¼Œç¤ºä¾‹ï¼Œæˆ‘å¯åŠ¨è‡ªåˆ¶çš„kafkaé•œåƒ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run ttbb/kafka:mate</span><br></pre></td></tr></table></figure>

<h3 id="æ‰¾åˆ°javaç¨‹åºçš„pid"><a href="#æ‰¾åˆ°javaç¨‹åºçš„pid" class="headerlink" title="æ‰¾åˆ°javaç¨‹åºçš„pid"></a>æ‰¾åˆ°javaç¨‹åºçš„pid</h3><p><code>ps -ef</code>æˆ–è€…<code>jps</code>å‡å¯ï¼Œå…¶ä¸­<code>jps</code>éœ€è¦å®‰è£…jdk</p>
<p><img src="/Images/arthas-flame-graph1.png" alt="image-20210929143232887"></p>
<h3 id="å®‰è£…arthas"><a href="#å®‰è£…arthas" class="headerlink" title="å®‰è£…arthas"></a>å®‰è£…arthas</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/alibaba/arthas/releases/download/arthas-all-3.5.4/arthas-bin.zip</span><br><span class="line"><span class="built_in">mkdir</span> -p arthas</span><br><span class="line">unzip arthas-bin.zip -d arthas</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨arthasè¿æ¥åˆ°ç›®æ ‡ç¨‹åº"><a href="#ä½¿ç”¨arthasè¿æ¥åˆ°ç›®æ ‡ç¨‹åº" class="headerlink" title="ä½¿ç”¨arthasè¿æ¥åˆ°ç›®æ ‡ç¨‹åº"></a>ä½¿ç”¨arthasè¿æ¥åˆ°ç›®æ ‡ç¨‹åº</h3><p><img src="/Images/arthas-flame-graph2.png" alt="image-20210929143537663"></p>
<h3 id="å¼€å§‹profiler"><a href="#å¼€å§‹profiler" class="headerlink" title="å¼€å§‹profiler"></a>å¼€å§‹profiler</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profiler start</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå‡ºç°<code>Perf events unavailable. See stderr of the target process.</code>å¦‚å›¾æ‰€ç¤º</p>
<p><img src="/Images/arthas-flame-graph3.png" alt="image-20210929143621015"></p>
<p>éœ€è¦åœ¨dockeræ‰€åœ¨è™šæ‹Ÿæœºä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/kernel/perf_event_paranoid</span><br><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/kptr_restrict</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯macç”¨æˆ·</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œä¸Šè¿°å‘½ä»¤è¿›å…¥dockeræ‰€åœ¨çš„è™šæ‹Ÿæœºæ“ä½œå³å¯</p>
<p>æ³¨æ„ï¼Œåœ¨éƒ¨åˆ†dockerç‰ˆæœ¬ä¸­ï¼Œæœ‰å¯èƒ½è¿˜æ— æ³•è¿›è¡Œprofileré‡‡é›†ï¼Œæ‚¨å¯èƒ½éœ€è¦ä»¥ç‰¹æƒæ–¹å¼å¯åŠ¨å®¹å™¨ï¼Œä¸è¿‡ï¼Œä¸ºäº†å®šä½æ€§èƒ½é—®é¢˜ï¼Œè¿™æ€»æ˜¯å€¼å¾—ä»˜å‡ºçš„ï¼Œä¸æ˜¯å—ï¼Ÿ</p>
<p><img src="/Images/arthas-flame-graph4.png" alt="image-20210929151106090"></p>
<h3 id="ç­‰å¾…profilerä¸€æ®µæ—¶é—´"><a href="#ç­‰å¾…profilerä¸€æ®µæ—¶é—´" class="headerlink" title="ç­‰å¾…profilerä¸€æ®µæ—¶é—´"></a>ç­‰å¾…profilerä¸€æ®µæ—¶é—´</h3><p>ä¸€èˆ¬ç­‰å¾…ä¸€åˆ†é’Ÿå³å¯</p>
<h3 id="ç»“æŸprofiler"><a href="#ç»“æŸprofiler" class="headerlink" title="ç»“æŸprofiler"></a>ç»“æŸprofiler</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profiler stop</span><br></pre></td></tr></table></figure>

<p><img src="/Images/arthas-flame-graph5.png" alt="image-20210929151209352"></p>
<h3 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><p>Congratulationsï¼Œå®Œæˆäº†ç«ç„°å›¾çš„è¾“å‡ºï¼Œç°åœ¨ä½ å¯ä»¥ä½¿ç”¨ç«ç„°å›¾æ¥åˆ†ææ‰§è¡Œæ—¶é—´è¾ƒé•¿çš„æ–¹æ³•å•¦</p>
<p><img src="/Images/arthas-flame-graph6.png" alt="image-20210929151506122"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://hezhangjian.com/2021/08/28/OpenKruise%E7%94%A8%E5%88%B0%E7%9A%84%E6%8A%80%E6%9C%AF%20%E7%BD%91%E7%BB%9C%E7%9B%91%E5%90%AC%E5%8F%A5%E6%9F%84%E5%8A%A8%E6%80%81%E8%BD%AC%E7%A7%BB%20%E5%88%87%E6%8D%A2%E7%BD%91%E7%BB%9C%E7%9B%91%E5%90%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangjian He">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | å¼ ä¿­çš„åšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/08/28/OpenKruise%E7%94%A8%E5%88%B0%E7%9A%84%E6%8A%80%E6%9C%AF%20%E7%BD%91%E7%BB%9C%E7%9B%91%E5%90%AC%E5%8F%A5%E6%9F%84%E5%8A%A8%E6%80%81%E8%BD%AC%E7%A7%BB%20%E5%88%87%E6%8D%A2%E7%BD%91%E7%BB%9C%E7%9B%91%E5%90%AC/" class="post-title-link" itemprop="url">OpenKruiseç”¨åˆ°çš„æŠ€æœ¯ ç½‘ç»œç›‘å¬å¥æŸ„åŠ¨æ€è½¬ç§» åˆ‡æ¢ç½‘ç»œç›‘å¬</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2021-08-28 20:04:58" itemprop="dateCreated datePublished" datetime="2021-08-28T20:04:58+08:00">2021-08-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-10-21 20:55:02" itemprop="dateModified" datetime="2025-10-21T20:55:02+08:00">2025-10-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>ä»Šå¤©çœ‹åˆ°äº†<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/tTipcU8MKxTpFurWNEUIww">https://mp.weixin.qq.com/s/tTipcU8MKxTpFurWNEUIww</a> ä¸­çƒ­è¿ç§»ç½‘ç»œå¥æŸ„çš„åŠŸèƒ½ï¼Œå¿ä¸ä½è‡ªå·±åœ¨æœºå™¨ä¸Šå®éªŒäº†ä¸€ä¸‹ï¼Œç¡®å®å¯ä»¥å®ç°ç½‘ç»œå¥æŸ„çš„è¿ç§»ã€‚å®éªŒä»£ç å¦‚ä¸‹</p>
<h2 id="old-server"><a href="#old-server" class="headerlink" title="old_server"></a>old_server</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;net&quot;</span></span><br><span class="line">	<span class="string">&quot;syscall&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	tcpAddr := net.TCPAddr&#123;Port: <span class="number">8001</span>&#125;</span><br><span class="line">	tcpLn, err := net.ListenTCP(<span class="string">&quot;tcp4&quot;</span>, &amp;tcpAddr)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	f, _ := tcpLn.File()</span><br><span class="line">	fdNum := f.Fd()</span><br><span class="line">	data := syscall.UnixRights(<span class="type">int</span>(fdNum))</span><br><span class="line">	<span class="comment">// ä¸æ–°ç‰ˆæœ¬sidecaré€šè¿‡Unix Domain Socketå»ºç«‹é“¾æ¥</span></span><br><span class="line">	raddr, _ := net.ResolveUnixAddr(<span class="string">&quot;unix&quot;</span>, <span class="string">&quot;/dev/shm/migrate.sock&quot;</span>)</span><br><span class="line">	uds, _ := net.DialUnix(<span class="string">&quot;unix&quot;</span>, <span class="literal">nil</span>, raddr)</span><br><span class="line">	<span class="comment">// é€šè¿‡UDSï¼Œå‘é€ListenFDåˆ°æ–°ç‰ˆæœ¬sidecarå®¹å™¨</span></span><br><span class="line">	_, _, _ = uds.WriteMsgUnix(<span class="literal">nil</span>, data, <span class="literal">nil</span>)</span><br><span class="line">	<span class="comment">// åœæ­¢æ¥æ”¶æ–°çš„requestï¼Œå¹¶ä¸”å¼€å§‹æ’æ°´é˜¶æ®µ</span></span><br><span class="line">	tcpLn.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="new-server"><a href="#new-server" class="headerlink" title="new_server"></a>new_server</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;syscall&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// æ–°ç‰ˆæœ¬sidecar æ¥æ”¶ListenFDï¼Œå¹¶ä¸”å¼€å§‹å¯¹å¤–æœåŠ¡</span></span><br><span class="line">	<span class="comment">// ç›‘å¬UDS</span></span><br><span class="line">	addr, _ := net.ResolveUnixAddr(<span class="string">&quot;unix&quot;</span>, <span class="string">&quot;/dev/shm/migrate.sock&quot;</span>)</span><br><span class="line">	unixLn, _ := net.ListenUnix(<span class="string">&quot;unix&quot;</span>, addr)</span><br><span class="line">	conn, _ := unixLn.AcceptUnix()</span><br><span class="line">	buf := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">32</span>)</span><br><span class="line">	oob := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">32</span>)</span><br><span class="line">	time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line">	<span class="comment">// æ¥æ”¶ ListenFD</span></span><br><span class="line">	_, oobn, _, _, _ := conn.ReadMsgUnix(buf, oob)</span><br><span class="line">	scms, _ := syscall.ParseSocketControlMessage(oob[:oobn])</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(scms) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		<span class="comment">// è§£æFDï¼Œå¹¶è½¬åŒ–ä¸º *net.TCPListener</span></span><br><span class="line">		fds, _ := syscall.ParseUnixRights(&amp;scms[<span class="number">0</span>])</span><br><span class="line">		f := os.NewFile(<span class="type">uintptr</span>(fds[<span class="number">0</span>]), <span class="string">&quot;&quot;</span>)</span><br><span class="line">		ln, _ := net.FileListener(f)</span><br><span class="line">		tcpLn, _ := ln.(*net.TCPListener)</span><br><span class="line">		http.Serve(tcpLn, &amp;MyHttp&#123;&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyHttp <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*MyHttp)</span></span> ServeHTTP(w http.ResponseWriter, req *http.Request) &#123;</span><br><span class="line">	fmt.Fprintf(w, <span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®éªŒç»“æœ"><a href="#å®éªŒç»“æœ" class="headerlink" title="å®éªŒç»“æœ"></a>å®éªŒç»“æœ</h2><ul>
<li>å…ˆå¯åŠ¨new_server</li>
<li>å†å¯åŠ¨old_server</li>
<li>ç„¶åè®¿é—®<code>localhost:8001</code>ï¼Œè¿”å›<code>hello world</code>ï¼Œè¿™æ˜¯<code>new_server</code>è¿”å›çš„ç»“æœ</li>
</ul>
<h2 id="ä»£ç åœ°å€"><a href="#ä»£ç åœ°å€" class="headerlink" title="ä»£ç åœ°å€"></a>ä»£ç åœ°å€</h2><p><a target="_blank" rel="noopener" href="https://github.com/hezhangjian/go_demo/tree/main/demo_base/fd_migrate">https://github.com/hezhangjian/go_demo/tree/main/demo_base/fd_migrate</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="ä¸Šä¸€é¡µ" aria-label="ä¸Šä¸€é¡µ" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Zhangjian He</span>
  </div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
