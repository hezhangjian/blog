<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hezhangjian.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12,"onmobile":false},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null,"show_result":false},"fold":{"enable":false,"height":500},"language":false,"highlight_theme":"normal"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="Raft主要使用了重叠的大多数技术来保证算法的安全 Raft首要追求的是可理解性 Raft使用数个技术来提升可理解性。包括 问题分解：主备选举、日志复制、安全性 尽量减少状态空间（相比Paxos，Raft减少了不确定性）  Raft新颖的特性强leader日志文件只单向传输，简化状态 leader选举Raft使用随机定时器来选举leader。只添加了很小的机制，却能简单、快速解决冲突 Member">
<meta property="og:type" content="article">
<meta property="og:title" content="Raft论文笔记">
<meta property="og:url" content="https://hezhangjian.com/2021/05/07/Raft%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="张俭的博客">
<meta property="og:description" content="Raft主要使用了重叠的大多数技术来保证算法的安全 Raft首要追求的是可理解性 Raft使用数个技术来提升可理解性。包括 问题分解：主备选举、日志复制、安全性 尽量减少状态空间（相比Paxos，Raft减少了不确定性）  Raft新颖的特性强leader日志文件只单向传输，简化状态 leader选举Raft使用随机定时器来选举leader。只添加了很小的机制，却能简单、快速解决冲突 Member">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hezhangjian.com/Images/raft.png">
<meta property="article:published_time" content="2021-05-07T10:24:18.000Z">
<meta property="article:modified_time" content="2025-10-21T11:32:27.313Z">
<meta property="article:author" content="Zhangjian He">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hezhangjian.com/Images/raft.png">


<link rel="canonical" href="https://hezhangjian.com/2021/05/07/Raft%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://hezhangjian.com/2021/05/07/Raft%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/","path":"2021/05/07/Raft论文笔记/","title":"Raft论文笔记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Raft论文笔记 | 张俭的博客</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">张俭的博客</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Raft%E4%BD%BF%E7%94%A8%E6%95%B0%E4%B8%AA%E6%8A%80%E6%9C%AF%E6%9D%A5%E6%8F%90%E5%8D%87%E5%8F%AF%E7%90%86%E8%A7%A3%E6%80%A7%E3%80%82%E5%8C%85%E6%8B%AC"><span class="nav-number">1.</span> <span class="nav-text">Raft使用数个技术来提升可理解性。包括</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Raft%E6%96%B0%E9%A2%96%E7%9A%84%E7%89%B9%E6%80%A7"><span class="nav-number">2.</span> <span class="nav-text">Raft新颖的特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%BAleader"><span class="nav-number">3.</span> <span class="nav-text">强leader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#leader%E9%80%89%E4%B8%BE"><span class="nav-number">4.</span> <span class="nav-text">leader选举</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Membership%E5%8F%98%E6%9B%B4"><span class="nav-number">5.</span> <span class="nav-text">Membership变更</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="nav-number"></span> <span class="nav-text">复制状态机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A5%E5%9B%BE"><span class="nav-number">1.</span> <span class="nav-text">补图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95%E6%8B%A5%E6%9C%89%E5%A6%82%E4%B8%8B%E7%9A%84%E5%85%B8%E5%9E%8B%E5%B1%9E%E6%80%A7"><span class="nav-number"></span> <span class="nav-text">一致性算法拥有如下的典型属性</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Raft%E5%8D%8F%E8%AE%AE"><span class="nav-number"></span> <span class="nav-text">Raft协议</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E8%BF%B0"><span class="nav-number"></span> <span class="nav-text">简述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Leader%E9%80%89%E4%B8%BE"><span class="nav-number">1.</span> <span class="nav-text">Leader选举</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E5%A4%8D%E5%88%B6"><span class="nav-number">2.</span> <span class="nav-text">日志复制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8"><span class="nav-number">3.</span> <span class="nav-text">安全</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E7%9A%84%E8%AF%A6%E7%BB%86%E5%86%85%E5%AE%B9"><span class="nav-number"></span> <span class="nav-text">安全的详细内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Election-Safety-%E9%80%89%E4%B8%BE%E5%AE%89%E5%85%A8"><span class="nav-number">1.</span> <span class="nav-text">Election Safety 选举安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Leader%E4%BB%85%E8%BF%BD%E5%8A%A0"><span class="nav-number">2.</span> <span class="nav-text">Leader仅追加</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Log-Matching-%E6%97%A5%E5%BF%97%E5%8C%B9%E9%85%8D"><span class="nav-number">3.</span> <span class="nav-text">Log Matching 日志匹配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Leader-Completeness-Leader%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="nav-number">4.</span> <span class="nav-text">Leader Completeness Leader完整性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#State-Machine-Safety-%E7%8A%B6%E6%80%81%E6%9C%BA%E5%AE%89%E5%85%A8"><span class="nav-number">5.</span> <span class="nav-text">State Machine Safety 状态机安全</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Raft%E5%9F%BA%E7%A1%80"><span class="nav-number"></span> <span class="nav-text">Raft基础</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Leader%E9%80%89%E4%B8%BE-1"><span class="nav-number"></span> <span class="nav-text">Leader选举</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E5%A4%8D%E5%88%B6-1"><span class="nav-number"></span> <span class="nav-text">日志复制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E5%85%A8-1"><span class="nav-number"></span> <span class="nav-text">安全</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E4%B8%BE%E9%99%90%E5%88%B6"><span class="nav-number">1.</span> <span class="nav-text">选举限制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E4%BA%A4%E4%B9%8B%E5%89%8D%E4%BB%BB%E6%9C%9F%E7%9A%84entry"><span class="nav-number">2.</span> <span class="nav-text">提交之前任期的entry</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%80%A7%E4%BF%9D%E8%AF%81"><span class="nav-number">3.</span> <span class="nav-text">安全性保证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E5%92%8C%E5%8F%AF%E7%94%A8%E6%80%A7"><span class="nav-number">4.</span> <span class="nav-text">时间和可用性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%88%90%E5%91%98%E5%8F%98%E6%9B%B4"><span class="nav-number"></span> <span class="nav-text">集群成员变更</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E5%8E%8B%E7%BC%A9"><span class="nav-number"></span> <span class="nav-text">日志压缩</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E4%BA%A4%E4%BA%92"><span class="nav-number"></span> <span class="nav-text">客户端的交互</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%A7%E8%83%BD"><span class="nav-number"></span> <span class="nav-text">性能</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0"><span class="nav-number"></span> <span class="nav-text">实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#InstallSnapshot-RPC%E6%8E%A5%E5%8F%A3"><span class="nav-number"></span> <span class="nav-text">InstallSnapshot RPC接口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0"><span class="nav-number">1.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E4%BD%93"><span class="nav-number">2.</span> <span class="nav-text">返回体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E6%94%B6%E6%96%B9%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.</span> <span class="nav-text">接收方的实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#State-%E7%8A%B6%E6%80%81"><span class="nav-number"></span> <span class="nav-text">State 状态</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%80%E6%9C%89%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E7%8A%B6%E6%80%81"><span class="nav-number">1.</span> <span class="nav-text">所有服务器上的持久化状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%80%E6%9C%89%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84%E5%8F%AF%E5%8F%98%E7%8A%B6%E6%80%81"><span class="nav-number">2.</span> <span class="nav-text">所有服务器上的可变状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#leader%E4%B8%8A%E7%9A%84%E5%8F%AF%E5%8F%98%E7%8A%B6%E6%80%81"><span class="nav-number">3.</span> <span class="nav-text">leader上的可变状态</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AppendEntryies-RPC"><span class="nav-number"></span> <span class="nav-text">AppendEntryies RPC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0-1"><span class="nav-number">1.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C"><span class="nav-number">2.</span> <span class="nav-text">返回结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E6%94%B6%E6%96%B9%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.</span> <span class="nav-text">接收方实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RequestVote-RPC"><span class="nav-number"></span> <span class="nav-text">RequestVote RPC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0-2"><span class="nav-number">1.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C-1"><span class="nav-number">2.</span> <span class="nav-text">返回结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E6%94%B6%E6%96%B9%E5%AE%9E%E7%8E%B0-1"><span class="nav-number">3.</span> <span class="nav-text">接收方实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Server%E9%81%B5%E5%AE%88%E7%9A%84%E8%A7%84%E5%88%99-Rules-for-Servers"><span class="nav-number"></span> <span class="nav-text">Server遵守的规则 Rules for Servers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%80%E6%9C%89%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">1.</span> <span class="nav-text">所有服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Follower"><span class="nav-number">2.</span> <span class="nav-text">Follower</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%80%99%E9%80%89%E8%80%85"><span class="nav-number">3.</span> <span class="nav-text">候选者</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Leader"><span class="nav-number">4.</span> <span class="nav-text">Leader</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zhangjian He</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">128</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/hezhangjian" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hezhangjian" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://x.com/hezhangjian" title="Twitter → https:&#x2F;&#x2F;x.com&#x2F;hezhangjian" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hezhangjian.com/2021/05/07/Raft%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zhangjian He">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="张俭的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Raft论文笔记 | 张俭的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Raft论文笔记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-07 18:24:18" itemprop="dateCreated datePublished" datetime="2021-05-07T18:24:18+08:00">2021-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-10-21 19:32:27" itemprop="dateModified" datetime="2025-10-21T19:32:27+08:00">2025-10-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>Raft主要使用了重叠的大多数技术来保证算法的安全</p>
<p>Raft首要追求的是可理解性</p>
<h3 id="Raft使用数个技术来提升可理解性。包括"><a href="#Raft使用数个技术来提升可理解性。包括" class="headerlink" title="Raft使用数个技术来提升可理解性。包括"></a>Raft使用数个技术来提升可理解性。包括</h3><ul>
<li>问题分解：主备选举、日志复制、安全性</li>
<li>尽量减少状态空间（相比Paxos，Raft减少了不确定性）</li>
</ul>
<h3 id="Raft新颖的特性"><a href="#Raft新颖的特性" class="headerlink" title="Raft新颖的特性"></a>Raft新颖的特性</h3><h3 id="强leader"><a href="#强leader" class="headerlink" title="强leader"></a>强leader</h3><p>日志文件只单向传输，简化状态</p>
<h3 id="leader选举"><a href="#leader选举" class="headerlink" title="leader选举"></a>leader选举</h3><p>Raft使用随机定时器来选举leader。只添加了很小的机制，却能简单、快速解决冲突</p>
<h3 id="Membership变更"><a href="#Membership变更" class="headerlink" title="Membership变更"></a>Membership变更</h3><p>Raft的Membership变更机制使用<code>joint consensus</code>方法，在变更过程中，两个不同配置的<strong>大多数</strong> 重叠。这使得在集群成员变更时，也能正常处理请求</p>
<h2 id="复制状态机"><a href="#复制状态机" class="headerlink" title="复制状态机"></a>复制状态机</h2><h3 id="补图"><a href="#补图" class="headerlink" title="补图"></a>补图</h3><p>保证复制状态机的一致,也就保证了数据的一致</p>
<h2 id="一致性算法拥有如下的典型属性"><a href="#一致性算法拥有如下的典型属性" class="headerlink" title="一致性算法拥有如下的典型属性"></a>一致性算法拥有如下的典型属性</h2><ul>
<li>在非拜占庭场景下，保证了正确性。包括 网络延迟、分区、丢包、乱序等</li>
<li>当大多数节点在线的时候，功能可用</li>
<li>不依赖时间来保证日志的一致性。错误的时钟和极大地消息延时，在最差的场景下，可能会导致一致性问题</li>
<li>在最常见的场景下，当一轮大多数节点反悔的时候，就能完成一个命令。小部分节点响应缓慢并不影响系统的整体性能。</li>
</ul>
<h1 id="Raft协议"><a href="#Raft协议" class="headerlink" title="Raft协议"></a>Raft协议</h1><h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><h3 id="Leader选举"><a href="#Leader选举" class="headerlink" title="Leader选举"></a>Leader选举</h3><p>新的leader必须在已存在的leader宕机后选出</p>
<h3 id="日志复制"><a href="#日志复制" class="headerlink" title="日志复制"></a>日志复制</h3><p>leader必须从客户端哪里接收日志请求，复制到整个集群，迫使其他人达成一致</p>
<h3 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h3><p>Raft的安全属性关键。如果任何服务器将一个entry log复制到状态机中，那么其他任意服务器都不能在相同的log index上放置不同的命令。</p>
<h2 id="安全的详细内容"><a href="#安全的详细内容" class="headerlink" title="安全的详细内容"></a>安全的详细内容</h2><h3 id="Election-Safety-选举安全"><a href="#Election-Safety-选举安全" class="headerlink" title="Election Safety 选举安全"></a>Election Safety 选举安全</h3><p>每一个任期内，至多只会有一个leader</p>
<h3 id="Leader仅追加"><a href="#Leader仅追加" class="headerlink" title="Leader仅追加"></a>Leader仅追加</h3><p>leader不会覆写或者删除已存在的entry，只会追加新的entry（todo 待确认，是写入的，还是commit的，从leader可能是一个老的节点来说，这里应该说commit的更为恰当）</p>
<h3 id="Log-Matching-日志匹配"><a href="#Log-Matching-日志匹配" class="headerlink" title="Log Matching 日志匹配"></a>Log Matching 日志匹配</h3><p>如果两个日志具有相同的任期值和相同的index，那么直到这个index之前的日志都是一样的</p>
<h3 id="Leader-Completeness-Leader完整性"><a href="#Leader-Completeness-Leader完整性" class="headerlink" title="Leader Completeness Leader完整性"></a>Leader Completeness Leader完整性</h3><p>如果一个日志在一个给定任期内提交了，那么这个日志会一直存在，存在在任何高任期的Leader之中</p>
<h3 id="State-Machine-Safety-状态机安全"><a href="#State-Machine-Safety-状态机安全" class="headerlink" title="State Machine Safety 状态机安全"></a>State Machine Safety 状态机安全</h3><p>如果服务器已在其状态机上将给定索引的日志条目应用于其状态机，则其他服务器将永远不会对同一索引应用不同的日志条目</p>
<h2 id="Raft基础"><a href="#Raft基础" class="headerlink" title="Raft基础"></a>Raft基础</h2><p>Raft将时间切分成任期时长间隔的任期。Raft保证一个任期内至多只有一个Leader。任期可以称为是Raft中的逻辑时钟。每个服务器之间都会互相传播任期值。</p>
<h2 id="Leader选举-1"><a href="#Leader选举-1" class="headerlink" title="Leader选举"></a>Leader选举</h2><p>Raft使用随机的选举时间来保证分裂投票场景少见并快速解决。将选举超时设定为一个范围。</p>
<p>Raft的作者们考虑过使用不同的Rank值，当分裂投票的时候，Rank值高的优先成为主节点，但在可用性方面有细微的问题。Rank值低的节点需要超时才能成为新的leader，这个时间间隔如果太短，会破坏已有的选举，集群太过敏感）</p>
<p>最终认为随机的措施更明显、更易懂</p>
<h2 id="日志复制-1"><a href="#日志复制-1" class="headerlink" title="日志复制"></a>日志复制</h2><p>Leader来决定何时将日志提交到状态机是安全的，叫做<strong>committed</strong>提交。Raft保证提交过的entry都是持久化的，然后最终会被所有的状态机执行。</p>
<p>只有当前的Leader在任期内，然后将其复制到大多数节点，才算做committed！（这里有和仅仅复制到大多数节点有着重要的区别）然后这里会将之前的日志提交。</p>
<p>Leader每次发送AppendEntries RPC请求时，确认在这之前的日志和从节点完全相同。</p>
<p>Raft可以accept、replicate、应用新的日志记录。在正常场景下，经过一轮大多数RPC调用，就可以复制完成。</p>
<h2 id="安全-1"><a href="#安全-1" class="headerlink" title="安全"></a>安全</h2><p>假如，当leader提交数个日志的时候，follower不可用，然后他当选了leader之后，提交的日志把之前提交的日志覆盖了怎么办？</p>
<p>这里在选举当选leader的上面加了个限制，保证了之后的leader包含了之前所有已提交的entry。</p>
<h3 id="选举限制"><a href="#选举限制" class="headerlink" title="选举限制"></a>选举限制</h3><p>Raft使用投票阶段来防止一个没有之前提交过日志的候选者当选leader。候选者必须联络大多数节点才能当选，这就意味着提交过的entry一定在其中的一个服务器中。</p>
<h3 id="提交之前任期的entry"><a href="#提交之前任期的entry" class="headerlink" title="提交之前任期的entry"></a>提交之前任期的entry</h3><p>leader不能立刻得出结论：之前任期的日志复制到大多数节点就已经算commit了。</p>
<p><img src="/Images/raft.png" alt="image-20210325211802223"></p>
<ul>
<li>a S1是leader，然后部分复制了日志2</li>
<li>b S1宕机，S5接受了S3和S4的投票当选了任期3的leader，在index2接受了不同的entry</li>
<li>c S5宕机，S1重启，当选了leader，继续复制</li>
<li>d S1宕机，S5重启，然后用任期3的日志覆盖了其他节点</li>
<li>e 然而如果S1在宕机前，把日志覆盖到大多数节点，那么S5就不能当选leader了</li>
</ul>
<p>为了避免上图的问题，Raft绝不将复制的数量当作commit 日志的依据。只有当前任期下的entry log通过复制数量来计算。一旦当前任期的entry被提交，那么之前所有的entry都被间接commit了。</p>
<h3 id="安全性保证"><a href="#安全性保证" class="headerlink" title="安全性保证"></a>安全性保证</h3><p>我们用反证法证明一旦<strong>Leader Completeness Property</strong>没有满足，我们就会推断出一个矛盾。假设任期T的Leader提交了一个log entry在任期T，但是这个log entry没有被将来一些任期的Leader拥有。假设有一个没有包含这个entry的最小的任期U的Leader，Leader U没有存储这个entry</p>
<ul>
<li><ol>
<li>在选举的时候，提交的entry必须不在leader U的日志中（leader从不删除或复写日志）</li>
</ol>
</li>
<li><ol start="2">
<li>Leader将这个entry复制到了集群中的大多数节点，并且leader U接收到了集群中大多数节点的投票。至少有一个服务器，即从leader T哪里接受了entry，并且给U投票。这是达成矛盾的关键</li>
<li>voter 必须在接收leaderT的entry之前给U投票。否则它就要拒绝T的写入请求</li>
<li>当voter给U投票的时候，它始终持久化着这个日志，因为每个中间的leader都包含这个entry，leader不会删除这个entry，除非冲突，follower也不会删除这个entry</li>
<li>voter给U投票，所以U的日志必须至少和voter的一样新，这就达成了第一个冲突</li>
<li>首先假设，如果voter和U都有同样的上一次log的任期，U的日志至少和vote一样。矛盾，因为最初假设U没有这个log，而voter有。</li>
<li>否则，leader U的上次log任期比voter的大。此外，它比T大，因为选民的上一个log term至少为T（其中包含来自T的提交entry）。 创建leaderU的最后一个log term的较早的领导者必须在其日志中包含已提交的条目（通过假设）。 然后，通过<strong>Log Matching Property</strong>，leaderU的日志还必须包含已提交的条目，这是矛盾的</li>
<li>这就完成了矛盾的证明。比T任期大的leader一定包含了任期T内提交的entry</li>
</ol>
</li>
</ul>
<h3 id="时间和可用性"><a href="#时间和可用性" class="headerlink" title="时间和可用性"></a>时间和可用性</h3><p>Raft可以选举并维持一个稳定的leader，只要系统满足如下的时间限制条件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">broadcastTime &lt;&lt; electionTimeout &lt;&lt; MTBF</span><br></pre></td></tr></table></figure>

<p>broadcastTime是进行一个并行rpc到所有服务器来回的平均时间。MTBF是单个服务器故障的平均时间。</p>
<p>广播时间必须比选举时间小一个量级，所以leader放心的发送心跳消息，维护自己的follower。加上随机的选举时延，这个不等式也让选票分裂变得不可能。 如果广播时间和选举时间差不多，选举leader不稳定。</p>
<p>选举超时应该比MTBF小几个数量级，要不然选举的leader就不稳定。<br>broadcast的时间差不多在0.5ms到20ms<br>选举超时应该在100ms到500ms。<br>典型的服务器MTBF时间应该在数月或以上</p>
<h1 id="集群成员变更"><a href="#集群成员变更" class="headerlink" title="集群成员变更"></a>集群成员变更</h1><p>成员变更的时候，中途必须没有两个相同任期的leader。不幸的是，任何将服务器们直接从老配置变换到新配置都是不安全的。不可能一次性地原子性地把所有服务器的配置变更，所以中集群在中途可能会分裂为两个多数派。<br>为了保证安全性，集群成员变更必须使用两阶段的方式。有很多种方式实现两阶段提交。例如，一些系统使用第一次提交来禁用旧的配置，使得旧的配置无法接受客户端的请求，然后第二次操作启动新的配置。在Raft中，集群首先切换到一个过度的配置，叫做<code>joint consensus</code>。一旦<code>joint consensus</code>被提交，系统接下来过渡到新的配置。<code>joint consensus</code>结合了新老配置</p>
<ul>
<li>Log entry在两种配置下都会复制。即新机器和老机器都会复制entry</li>
<li>不管是老配置还是新配置，都有可能当选leader</li>
<li>Agreement(协议，包括选举和entry提交)需要老配置和新配置多数派都确认<br>补图 Figure11<br>集群配置通过复制日志中的特殊entry来进行存储、通信。</li>
</ul>
<p>上述流程有三个问题<br>第一个问题是，新的服务器可能初始没有存储任何log entry。如果现在添加到集群中，会花费一些时间来跟上集群的数据，这中间有可能无法commit新的log entry。为了避免可用性的gap。Raft在配置变更之前引入了一个额外的阶段，新的服务器首先<br>第二个问题是，cluster的leader可能不是新配置中的服务器。这个场景，leader的变化发生在新配置提交的时候。<br>第三个问题是，移除的服务器可以打乱整个集群。这些服务器接收不到心跳，这些服务器会超时然后启动新的选举。他们将使用新的任期发送<strong>RequestVote</strong> RPC，会导致当前的leader变为follower。新的leader最终会被选举，但是移除的服务器将会再次超时，重复整个过程，最终导致集群较差的可用性。<br>为了解决这个问题，Server当认为有leader存在的时候，会忽略<strong>RequestVote</strong>请求。如果服务器在选举超时前接收到<strong>RequestVote</strong> RPC请求，它并不会更新它的任期或是给予它的投票。这并不影响正常的选举（每个服务器在选举之前等待最小超时时间）。并且，这有助于避免移除的server破坏选举：如果一个leader可以发送心跳到他负责的集群中的大多数节点，他将不会被更高任期的节点罢免。</p>
<p>成员变更过程中如果发生Failover，老Leader宕机， Cold,new中任意一个节点都可能成为新Leader，如果新 Cold,newLeader上没有 日志，则继续使用Cold ，Follower上如果有 Cold,new 日志会被新Leader截断，回退到 Cold，成员变更失败；如果新Leader上有  Cold,new日志，则继续将未完成的成员变更流程走完。</p>
<p>新成员先加入再同步数据，成员变更可以立即完成，并且因为只要大多数成员同意即可加入，甚至可以加入还不存在的成员，加入后再慢慢同步数据。但在数据同步完成之前新成员无法服务，但新成员的加入可能让多数派集合增大，而新成员暂时又无法服务，此时如果有成员发生Failover，很可能导致无法满足多数成员存活的条件，让服务不可用。因此新成员先加入再同步数据，简化了成员变更，但可能降低服务的可用性。</p>
<p>新成员先同步数据再加入，成员变更需要后台异步进行，先将新成员作为Learner角色加入，只能同步数据，不具有投票权，不会增加多数派集合，等数据同步完成后再让新成员正式加入，正式加入后可立即开始工作，不影响服务可用性。因此新成员先同步数据再加入，不影响服务的可用性，但成员变更流程复杂，并且因为要先给新成员同步数据，不能加入还不存在的成员。</p>
<h1 id="日志压缩"><a href="#日志压缩" class="headerlink" title="日志压缩"></a>日志压缩</h1><p>每当有新的操作发生的时候，Raft的日志就会增长，然而在实际的系统中，日志并不能无边界地增长。<br>快照是最简单的压缩日志的方式。在快照中，整个系统的状态写入到持久化存储的快照中，然后在这之前的日志都可以丢弃。<br>todo 补图<br>其他方式，像日志清理或lsm树。在数据的一部分子集上面执行，它们均摊了压缩日志的消耗。</p>
<p>Leader创建snapshot，再分发给follower。有如下两个缺点<br>第一，Server必须选择何时进行快照，如果服务器快照进行地太频繁，将会浪费磁盘带宽和磁盘energy。如果快照太不频繁，会浪费磁盘的存储空间，然后增加了重放日志所需的时间。如果阈值设置地大，时间周期长的话，磁盘开销小。<br>第二，写快照会消耗较大的时间，我们不希望这个操作延迟了正常的操作。方案是使用<strong>Copy on write</strong>技术，这样子在不影响snapshot写入的情况下，集群可以接受新的更新。</p>
<h1 id="客户端的交互"><a href="#客户端的交互" class="headerlink" title="客户端的交互"></a>客户端的交互</h1><p>Raft实现了线性化的语义。<strong>Linearizable semantics</strong>。像es那样使用version，是达不到线性化的语义的。<br>在读取数据的时候需要额外的措施来保证线性化的语义。首先，leader必须知道最新有那些entry已经提交。<strong>Leader Completeness Property</strong> 保证了leader有所有的committed entries，但是在任期的开头，可能并不知道那些entry已被提交。（为了确认，可以发空请求来commit数据）<br>通过向大多数节点来发送心跳，来保证读请求的返回的是最新的。这里就依赖了前面所说的时钟。依赖时钟来实现安全。</p>
<h1 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h1><p>todo 补图<br>随机杀死leader，重新选举最短时间刚好是leader选举超时的一半，因为心跳超时时间刚好是选举超时的一半。</p>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><h2 id="InstallSnapshot-RPC接口"><a href="#InstallSnapshot-RPC接口" class="headerlink" title="InstallSnapshot RPC接口"></a>InstallSnapshot RPC接口</h2><p>由leader调用，发送snapshot的一部分到从节点。Leader总是按顺序发送chunk</p>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><ul>
<li>term leader的任期</li>
<li>leaderId 使得follower可重定向client的请求</li>
<li>lastIncludedIndex snapshot最后包含的index号</li>
<li>lastIncludedTerm snapshot最后包含的最后一个任期号</li>
<li>offset chunk在整个snapshot中的offset</li>
<li>data[] 原始数据</li>
<li>done 如果是last chunk则为true</li>
</ul>
<h3 id="返回体"><a href="#返回体" class="headerlink" title="返回体"></a>返回体</h3><p>term 当前任期，使得leader可以根据这个结果判断是否做操作</p>
<h3 id="接收方的实现"><a href="#接收方的实现" class="headerlink" title="接收方的实现"></a>接收方的实现</h3><ul>
<li>如果接收到的任期小于当前任期，则立刻返回</li>
<li>如果接收到的chunk offset为0，则开始创建快照文件</li>
<li>在给定的offset处写入数据</li>
<li>如果done为false，返回且等待接下来的数据</li>
<li>保存snapshot文件，丢弃之前存在的所有快照文件</li>
<li>如果现有日志条目的索引和术语与快照的最后一个包含的条目相同，请保留其后的日志条目并回复</li>
<li>丢弃整个日志文件</li>
<li>把状态机重设为快照的内容（也使用快照内的集群信息）</li>
</ul>
<h2 id="State-状态"><a href="#State-状态" class="headerlink" title="State 状态"></a>State 状态</h2><h3 id="所有服务器上的持久化状态"><a href="#所有服务器上的持久化状态" class="headerlink" title="所有服务器上的持久化状态"></a>所有服务器上的持久化状态</h3><p>在响应RPC之前更新到持久化存储上</p>
<ul>
<li>当前任期 server见过的最大任期值（初始值是0，单调递增）</li>
<li>votedFor 在当前任期内获得投票的候选人ID（如果没有，则为null）</li>
<li>log[] log entry;每一个包含一个状态机的命令，包含从leader获取的任期（初始index为1）</li>
</ul>
<h3 id="所有服务器上的可变状态"><a href="#所有服务器上的可变状态" class="headerlink" title="所有服务器上的可变状态"></a>所有服务器上的可变状态</h3><ul>
<li>commitIndex 已知要提交的最高日志条目的index（初始值是0，单调递增）</li>
<li>lastApplied 已知要应用到状态机上的最高index（初始值是0，单调递增）</li>
</ul>
<h3 id="leader上的可变状态"><a href="#leader上的可变状态" class="headerlink" title="leader上的可变状态"></a>leader上的可变状态</h3><p>选举后重新初始化</p>
<ul>
<li>nextIndex[] 对每个服务器，将要送给另一个服务器的下一个log entry的index（初始化为leader的lastLogIndex+1）</li>
<li>matchIndex[] 对每个服务器，知道的复制到该服务器的最大的log entry的索引。（初始化为0，单调递增）</li>
</ul>
<h2 id="AppendEntryies-RPC"><a href="#AppendEntryies-RPC" class="headerlink" title="AppendEntryies RPC"></a>AppendEntryies RPC</h2><p>被leader触发，用来复制log entry；也用于心跳。</p>
<h3 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h3><ul>
<li>term leader的任期</li>
<li>leaderId 使得follower可重定向client的请求</li>
<li>prevLogIndex 紧接新记录之前的日志条目索引</li>
<li>prevLogTerm 紧接新记录之前的日志条目索引的任期</li>
<li>entries[] 要存储的entries。心跳时为空，批量来提升性能</li>
<li>leaderCommit leader的commit index提交索引</li>
</ul>
<h3 id="返回结果"><a href="#返回结果" class="headerlink" title="返回结果"></a>返回结果</h3><ul>
<li>term 当前任期，使得leader可以根据这个结果判断是否做操作</li>
<li>success 如果follower包含了匹配的prevLogIndex和prevLogTerm，就返回true</li>
</ul>
<h3 id="接收方实现"><a href="#接收方实现" class="headerlink" title="接收方实现"></a>接收方实现</h3><ul>
<li>如果term &lt; current term，返回false</li>
<li>如果不包含匹配的prevLogIndex和prevLogTerm，就返回false</li>
<li>如果有一个存在的entry和新的冲突（相同的index，不同的term），删除哪个entry和在其之后的所有entry</li>
<li>添加没在log里面的所有entry</li>
<li>如果leaderCommit &gt; commitIndex, 设置commitIndex为leaderCommit、lastNewEntry的最小值</li>
</ul>
<h2 id="RequestVote-RPC"><a href="#RequestVote-RPC" class="headerlink" title="RequestVote RPC"></a>RequestVote RPC</h2><p>由candidate调用来收集选票</p>
<h3 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h3><ul>
<li>term 候选者的任期</li>
<li>candidateId 候选者的请求投票</li>
<li>lastLogIndex 候选者的最后log entry的索引</li>
<li>lastLogTerm 候选者的最后log entry的任期</li>
</ul>
<h3 id="返回结果-1"><a href="#返回结果-1" class="headerlink" title="返回结果"></a>返回结果</h3><ul>
<li>term 任期，可以让candidate根据任期做操作</li>
<li>voteGranted true代表候选者收到了选票</li>
</ul>
<h3 id="接收方实现-1"><a href="#接收方实现-1" class="headerlink" title="接收方实现"></a>接收方实现</h3><ul>
<li>如果term &lt; currentTerm返回false</li>
<li>如果votedFor或candidateId是null，并且候选者日志至少比接受者的新，给予自己的投票</li>
</ul>
<h2 id="Server遵守的规则-Rules-for-Servers"><a href="#Server遵守的规则-Rules-for-Servers" class="headerlink" title="Server遵守的规则 Rules for Servers"></a>Server遵守的规则 Rules for Servers</h2><h3 id="所有服务器"><a href="#所有服务器" class="headerlink" title="所有服务器"></a>所有服务器</h3><ul>
<li>如果commitIndex &gt; lastApplied: 增加lastApplied，把log[lastAplied]应用到状态机上</li>
<li>如果rpc请求或响应中，包含的任期T比当前的Term值大，则将当前的任期值设置为T，转换自己为follower</li>
</ul>
<h3 id="Follower"><a href="#Follower" class="headerlink" title="Follower"></a>Follower</h3><ul>
<li>向候选者和leader响应rpc</li>
<li>在选举超时的时间间隔内，没有接收到<strong>AppendEntries</strong> RPC请求或者投票给其他人，那么切换为候选者</li>
</ul>
<h3 id="候选者"><a href="#候选者" class="headerlink" title="候选者"></a>候选者</h3><ul>
<li>一旦转化为候选者，开始选举<ul>
<li>增加任期号</li>
<li>给自己投票</li>
<li>重置选举定时器</li>
<li>向其他服务器发送<strong>RequestVote</strong> RPC请求</li>
</ul>
</li>
<li>如果接收到了大部分节点的投票，成为leader</li>
<li>如果<strong>AppendEntries</strong> RPC从新的leader处返回，变为follower</li>
<li>如果选举超时，启动新的选举流程</li>
</ul>
<h3 id="Leader"><a href="#Leader" class="headerlink" title="Leader"></a>Leader</h3><ul>
<li>选举完成后：发送空的<strong>AppendEntries</strong> RPC请求到每个服务器（心跳），在空闲期间重复此操作避免选举超时</li>
<li>从客户端哪里接收到命令；添加entry到本地的日志中，待把这个entry复制到状态机后响应</li>
<li>如果对一个follower有，last log index &gt;&#x3D; nextIndex，从nextIndex开始发送<strong>AppendEntries</strong> RPC请求<ul>
<li>如果成功：更新follower的nextIndex和matchIndex</li>
<li>如果因为日志不一致的原因失败：降低nextIndex然后重试</li>
</ul>
</li>
<li>如果存在N，且N&gt;commitIndex,大多数节点的matchIndex[i]&gt;&#x3D;N，并且log[N].term &#x3D;&#x3D; cuurentTerm,设置commitIndex&#x3D;N</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/05/06/Pulsar%20broker%E9%87%87%E6%A0%B7%E8%BF%BD%E8%B8%AA%E5%8F%8A%E5%AF%B9%E6%8E%A5skywalking/" rel="prev" title="Pulsar broker采样追踪及对接skywalking">
                  <i class="fa fa-angle-left"></i> Pulsar broker采样追踪及对接skywalking
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/05/10/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E4%BC%98%E5%8C%96%E5%B0%8F%E6%8A%80%E5%B7%A7----%E6%8B%B7%E8%B4%9D%E6%97%B6%E6%8C%87%E5%AE%9A%E7%94%A8%E6%88%B7%E5%B1%9E%E7%BB%84/" rel="next" title="容器镜像优化小技巧----拷贝时指定用户属组">
                  容器镜像优化小技巧----拷贝时指定用户属组 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Zhangjian He</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
